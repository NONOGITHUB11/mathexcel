<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>MathExcel ‚Äî Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet"/>
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    :root{--bg:#0A0A0F;--surface:#111118;--surface2:#18181F;--surface3:#22222C;--border:rgba(255,255,255,.07);--bh:rgba(255,255,255,.12);--text:#F2F2F5;--muted:#7A7A8C;--accent:#7C5CFC;--accent2:#A78BFA;--gold:#F5C842;--green:#34D399;--red:#F87171;--blue:#60A5FA;--glow:rgba(124,92,252,.2);--r:14px}
    body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex}
    body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(124,92,252,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(124,92,252,.03) 1px,transparent 1px);background-size:32px 32px;pointer-events:none;z-index:0}
    .sidebar{width:220px;flex-shrink:0;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;padding:24px 0;position:sticky;top:0;height:100vh;z-index:10;overflow-y:auto}
    .sb-logo{padding:0 20px 20px;border-bottom:1px solid var(--border);margin-bottom:12px}
    .sb-mark{width:36px;height:36px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:10px;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:13px;font-weight:800;color:white;margin-bottom:8px}
    .sb-title{font-family:'Syne',sans-serif;font-size:15px;font-weight:800}
    .sb-sub{font-size:11px;color:var(--muted);margin-top:1px}
    .sb-section{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);padding:10px 20px 4px}
    .sb-item{display:flex;align-items:center;gap:9px;padding:8px 20px;font-size:13px;font-weight:500;color:var(--muted);cursor:pointer;transition:all .15s;border-left:2px solid transparent;text-decoration:none}
    .sb-item:hover{color:var(--text);background:var(--surface2)}
    .sb-item.active{color:var(--text);background:rgba(124,92,252,.1);border-left-color:var(--accent)}
    .sb-item .ico{font-size:14px;width:18px;text-align:center}
    .sb-foot{margin-top:auto;padding:14px 20px 0;border-top:1px solid var(--border)}
    .view-link{display:flex;align-items:center;gap:8px;width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:9px 12px;color:var(--muted);font-size:12px;font-weight:500;cursor:pointer;text-decoration:none;transition:all .15s}
    .view-link:hover{color:var(--text)}
    .main{flex:1;min-width:0;position:relative;z-index:1}
    .topbar{padding:18px 28px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;background:rgba(10,10,15,.9);backdrop-filter:blur(12px);position:sticky;top:0;z-index:5}
    .topbar h1{font-family:'Syne',sans-serif;font-size:19px;font-weight:800}
    .topbar p{font-size:12px;color:var(--muted);margin-top:2px}
    .save-btn{display:flex;align-items:center;gap:8px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:white;border:none;border-radius:10px;padding:10px 18px;font-family:'Syne',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all .15s;box-shadow:0 4px 16px var(--glow)}
    .save-btn:hover{transform:translateY(-1px)}
    .save-btn:disabled{opacity:.6;cursor:not-allowed;transform:none}
    .panel{display:none;padding:28px}.panel.active{display:block}
    .section-header{margin-bottom:20px;padding-bottom:14px;border-bottom:1px solid var(--border)}
    .section-header h2{font-family:'Syne',sans-serif;font-size:17px;font-weight:700}
    .section-header p{font-size:13px;color:var(--muted);margin-top:3px}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:20px;margin-bottom:16px}
    .card-title{font-family:'Syne',sans-serif;font-size:14px;font-weight:700;margin-bottom:14px}
    .card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
    .field{margin-bottom:14px}
    .field label{display:block;font-size:11px;font-weight:600;letter-spacing:.5px;color:var(--muted);text-transform:uppercase;margin-bottom:6px}
    .field input,.field textarea,.field select{width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:10px 13px;font-family:'DM Sans',sans-serif;font-size:14px;color:var(--text);outline:none;transition:border-color .15s,box-shadow .15s}
    .field input:focus,.field textarea:focus,.field select:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--glow)}
    .field input::placeholder,.field textarea::placeholder{color:var(--muted)}
    .field textarea{resize:vertical;min-height:70px}
    .field select option{background:var(--surface2)}
    .fr2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .fr3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    .add-btn{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:10px;background:none;border:1px dashed var(--border);border-radius:10px;color:var(--muted);font-size:13px;font-weight:500;cursor:pointer;transition:all .15s;margin-top:6px}
    .add-btn:hover{border-color:var(--accent);color:var(--accent2);background:rgba(124,92,252,.05)}
    .del-btn{background:none;border:none;color:var(--muted);cursor:pointer;padding:4px 8px;border-radius:6px;font-size:14px;transition:all .15s;flex-shrink:0}
    .del-btn:hover{background:rgba(248,113,113,.1);color:var(--red)}
    .list-item{display:flex;align-items:center;gap:12px;padding:11px 13px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;margin-bottom:7px}
    .li-info{flex:1;min-width:0}
    .li-name{font-size:14px;font-weight:500}
    .li-meta{font-size:12px;color:var(--muted);margin-top:2px}
    .badge{font-size:11px;font-weight:600;padding:3px 9px;border-radius:20px;flex-shrink:0}
    .b-done{background:rgba(52,211,153,.15);color:var(--green)}
    .b-ok{background:rgba(245,200,66,.15);color:var(--gold)}

    /* STUDENT CARDS */
    .student-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px;margin-bottom:16px}
    .s-card{background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:14px;position:relative}
    .s-top{display:flex;align-items:center;gap:10px;margin-bottom:10px}
    .s-av{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-weight:700;font-size:15px;color:white;flex-shrink:0}
    .s-name{font-size:14px;font-weight:600}
    .s-email{font-size:11px;color:var(--muted)}
    .s-del{position:absolute;top:10px;right:10px;background:none;border:none;color:var(--muted);cursor:pointer;padding:4px;border-radius:6px;font-size:13px;transition:all .15s}
    .s-del:hover{background:rgba(248,113,113,.1);color:var(--red)}
    .s-field{display:flex;align-items:center;gap:8px;margin-bottom:7px}
    .s-field label{font-size:10px;color:var(--muted);width:52px;flex-shrink:0;font-weight:600;text-transform:uppercase}
    .s-field input{flex:1;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:6px 9px;font-size:12px;color:var(--text);font-family:'DM Sans',sans-serif;outline:none}
    .s-field input:focus{border-color:var(--accent)}

    /* STUDENT SELECTOR */
    .student-selector{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:20px}
    .student-tab{display:flex;align-items:center;gap:8px;padding:8px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;cursor:pointer;font-size:13px;font-weight:500;color:var(--muted);transition:all .15s}
    .student-tab:hover{border-color:var(--accent);color:var(--text)}
    .student-tab.active{background:rgba(124,92,252,.15);border-color:var(--accent);color:var(--text)}
    .student-tab .av{width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-weight:700;font-size:11px;color:white;flex-shrink:0}

    /* WEEK GRID */
    .week-grid{background:var(--surface2);border:1px solid var(--border);border-radius:12px;overflow:hidden}
    .wg-row{display:grid;grid-template-columns:56px 1fr;border-bottom:1px solid var(--border)}
    .wg-row:last-child{border-bottom:none}
    .wg-day{font-size:10px;font-weight:700;letter-spacing:.5px;text-transform:uppercase;color:var(--muted);padding:12px 0 12px 14px;display:flex;align-items:flex-start;padding-top:13px}
    .wg-tasks{padding:7px 10px;display:flex;flex-wrap:wrap;gap:5px;align-items:flex-start}
    .task-chip{display:inline-flex;align-items:center;gap:5px;padding:3px 9px;border-radius:6px;font-size:11px}
    .task-chip.cours{background:rgba(124,92,252,.2);color:var(--accent2)}
    .task-chip.exo{background:rgba(52,211,153,.15);color:var(--green)}
    .task-chip.revise{background:rgba(245,200,66,.12);color:var(--gold)}
    .task-chip.lecture{background:rgba(96,165,250,.15);color:var(--blue)}
    .task-chip.devoir{background:rgba(248,113,113,.15);color:var(--red)}
    .task-chip.custom{background:rgba(167,139,250,.15);color:var(--accent2)}
    .cat-manager{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:12px;margin-bottom:12px}
    .cat-list{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:8px}
    .cat-pill{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:6px;font-size:12px;font-weight:500}
    .cat-pill .cat-del{background:none;border:none;cursor:pointer;font-size:11px;opacity:.6;padding:0;color:currentColor}
    .cat-pill .cat-del:hover{opacity:1}
    .cat-add-row{display:flex;gap:6px;align-items:center}
    .cat-input{flex:1;background:var(--surface);border:1px solid var(--border);border-radius:7px;padding:5px 9px;font-size:12px;color:var(--text);font-family:'DM Sans',sans-serif;outline:none}
    .cat-input:focus{border-color:var(--accent)}
    .color-pick{width:28px;height:28px;border:none;border-radius:6px;cursor:pointer;padding:0;background:none}
    .chip-del{background:none;border:none;color:currentColor;opacity:.5;cursor:pointer;font-size:11px;padding:0;line-height:1}
    .chip-del:hover{opacity:1}
    .add-task-row{display:flex;gap:5px;margin-top:3px;flex-wrap:wrap;width:100%}
    .at-input{flex:1;min-width:110px;background:var(--surface);border:1px solid var(--border);border-radius:7px;padding:5px 9px;font-size:11px;color:var(--text);font-family:'DM Sans',sans-serif;outline:none}
    .at-input:focus{border-color:var(--accent)}
    .at-select{background:var(--surface);border:1px solid var(--border);border-radius:7px;padding:5px 7px;font-size:11px;color:var(--text);font-family:'DM Sans',sans-serif;outline:none;cursor:pointer}
    .at-btn{background:var(--accent);color:white;border:none;border-radius:7px;padding:5px 11px;font-size:11px;font-weight:600;cursor:pointer}

    /* CHAPTER TABLE */
    .chap-item{display:flex;align-items:stretch;background:var(--surface2);border:1px solid var(--border);border-radius:12px;margin-bottom:7px;overflow:hidden}
    .chap-num{width:40px;background:linear-gradient(135deg,rgba(74,42,143,.8),rgba(108,63,197,.6));display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:12px;font-weight:700;color:white;flex-shrink:0}
    .chap-body{flex:1;padding:12px 14px}
    .chap-name-row{display:flex;align-items:center;gap:8px;margin-bottom:8px}
    .chap-name-input{flex:1;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:6px 9px;font-size:13px;font-weight:500;color:var(--text);font-family:'DM Sans',sans-serif;outline:none}
    .chap-name-input:focus{border-color:var(--accent)}
    .chap-status-sel{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:6px 9px;font-size:12px;color:var(--text);font-family:'DM Sans',sans-serif;outline:none;cursor:pointer;flex-shrink:0}
    .chap-links{display:grid;grid-template-columns:1fr 1fr 1fr;gap:7px}
    .clf{display:flex;align-items:center;gap:5px}
    .clf label{font-size:10px;color:var(--muted);white-space:nowrap;font-weight:600;width:42px;flex-shrink:0}
    .clf input{flex:1;background:var(--surface);border:1px solid var(--border);border-radius:7px;padding:5px 7px;font-size:11px;color:var(--text);font-family:'DM Sans',sans-serif;outline:none}
    .clf input:focus{border-color:var(--accent)}
    .clf input::placeholder{color:var(--muted)}

    /* OBJ */
    .obj-item{display:flex;align-items:center;gap:10px;padding:10px 13px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;margin-bottom:7px;font-size:13px}
    .obj-dot{width:7px;height:7px;border-radius:50%;background:var(--accent);flex-shrink:0}

    /* MEET */
    .meet-status{display:flex;align-items:center;gap:10px;padding:10px 13px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;margin-top:10px;font-size:13px}
    .meet-dot{width:7px;height:7px;border-radius:50%;background:var(--muted);flex-shrink:0}
    .meet-dot.on{background:var(--green);box-shadow:0 0 6px var(--green)}

    /* AGENDA PREVIEW */
    .agenda-ph{height:160px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;color:var(--muted);font-size:13px;background:var(--surface2);border-radius:10px}

    /* VUE ELEVE ‚Äî student detail cards */
    .student-overview-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:16px}
    .ov-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:18px}
    .ov-title{font-family:'Syne',sans-serif;font-size:13px;font-weight:700;margin-bottom:12px;display:flex;align-items:center;gap:7px}
    .ov-empty{font-size:12px;color:var(--muted);text-align:center;padding:16px}
    .eval-pill{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;background:var(--surface2);border-radius:8px;margin-bottom:6px;font-size:13px}
    .eval-score{font-family:'Syne',sans-serif;font-size:16px;font-weight:800}
    .eval-score.good{color:var(--green)}.eval-score.ok{color:var(--gold)}.eval-score.bad{color:var(--red)}
    .obj-pill{display:flex;align-items:center;gap:8px;padding:7px 10px;background:var(--surface2);border-radius:8px;margin-bottom:5px;font-size:12px}
    .obj-pill-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
    .obj-pill-dot.done{background:var(--green)}.obj-pill-dot.pending{background:var(--muted)}
    .plan-mini{display:flex;flex-direction:column;gap:4px}
    .plan-row{display:flex;gap:8px;font-size:12px}
    .plan-day{color:var(--muted);font-weight:700;width:30px;flex-shrink:0}
    .plan-tasks{flex:1;color:var(--text)}
    .stat-row{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px}
    .mini-stat{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center}
    .mini-stat-val{font-family:'Syne',sans-serif;font-size:22px;font-weight:800;margin-bottom:2px}
    .mini-stat-lbl{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px}

    /* CONFIG BOX */
    .config-box{background:rgba(124,92,252,.08);border:1px solid rgba(124,92,252,.3);border-radius:12px;padding:18px;margin-bottom:16px}
    .config-box h3{font-family:'Syne',sans-serif;font-size:14px;font-weight:700;margin-bottom:7px;color:var(--accent2)}
    .config-box p{font-size:12px;color:var(--muted);line-height:1.6;margin-bottom:10px}

    /* INLINE ROW */
    .inline-row{display:flex;gap:8px;margin-top:8px}
    .inline-input{flex:1;background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:9px 12px;font-family:'DM Sans',sans-serif;font-size:13px;color:var(--text);outline:none}
    .inline-input:focus{border-color:var(--accent)}
    .inline-btn{background:var(--accent);color:white;border:none;border-radius:10px;padding:9px 14px;font-size:13px;font-weight:600;cursor:pointer;white-space:nowrap}

    /* TOAST */
    .toast{position:fixed;bottom:24px;right:24px;background:var(--surface2);border:1px solid var(--green);color:var(--green);border-radius:12px;padding:12px 18px;font-size:14px;font-weight:500;display:flex;align-items:center;gap:10px;transform:translateY(80px);opacity:0;transition:all .3s cubic-bezier(.34,1.56,.64,1);z-index:100;box-shadow:0 8px 32px rgba(0,0,0,.4)}
    .toast.show{transform:translateY(0);opacity:1}
  </style>
</head>
<body>
<aside class="sidebar">
  <div class="sb-logo"><div class="sb-mark">M‚àë</div><div class="sb-title">MathExcel</div><div class="sb-sub">Panneau Admin</div></div>
  <div class="sb-section">Global</div>
  <a class="sb-item active" onclick="sp('config',this)" href="#"><span class="ico">‚öôÔ∏è</span>Configuration</a>
  <a class="sb-item" onclick="sp('eleves',this)" href="#"><span class="ico">üë®‚Äçüéì</span>√âl√®ves</a>
  <a class="sb-item" onclick="sp('cours',this)" href="#"><span class="ico">üìö</span>Cours & ressources</a>
  <a class="sb-item" onclick="sp('replays',this)" href="#"><span class="ico">üé•</span>Replays</a>
  <a class="sb-item" onclick="sp('message',this)" href="#"><span class="ico">üí¨</span>Message coach</a>
  <div class="sb-section">Par √©l√®ve</div>
  <a class="sb-item" onclick="sp('vue-eleve',this)" href="#"><span class="ico">üëÅÔ∏è</span>Vue √©l√®ve</a>
  <a class="sb-item" onclick="sp('categories',this)" href="#"><span class="ico">üè∑Ô∏è</span>Cat√©gories</a>
  <a class="sb-item" onclick="sp('planning-eleve',this)" href="#"><span class="ico">üóìÔ∏è</span>Planning individuel</a>
  <a class="sb-item" onclick="sp('objectifs-eleve',this)" href="#"><span class="ico">üéØ</span>Objectifs individuels</a>
  <a class="sb-item" onclick="sp('evals-eleve',this)" href="#"><span class="ico">üìä</span>√âvaluations</a>
  <a class="sb-item" onclick="sp('agenda-eleve',this)" href="#"><span class="ico">üìÖ</span>Agenda & Meet</a>
  <div class="sb-foot"><a class="view-link" href="index.html" target="_blank"><span>üëÅÔ∏è</span>Voir le site √©l√®ve</a></div>
</aside>

<main class="main">
  <div class="topbar">
    <div><h1 id="pTitle">Configuration</h1><p id="pSub">Connecte ton repo GitHub</p></div>
    <button class="save-btn" id="saveBtn" onclick="saveAll()">üíæ Sauvegarder & Publier</button>
  </div>

  <!-- CONFIG -->
  <div class="panel active" id="panel-config">
    <div class="section-header"><h2>‚öôÔ∏è Configuration GitHub</h2><p>Les donn√©es sont dans <code>data.json</code> sur ton GitHub ‚Äî synchronis√©es sur tous les appareils.</p></div>
    <div class="config-box">
      <h3>üîë Comment configurer (une seule fois)</h3>
      <p>1. GitHub ‚Üí Settings ‚Üí Developer settings ‚Üí Personal access tokens ‚Üí Tokens (classic)<br/>2. Generate new token ‚Üí coche <strong>repo</strong> ‚Üí copie le token<br/>3. Remplis ci-dessous et clique Tester</p>
    </div>
    <div class="card">
      <div class="card-title">üîó Connexion GitHub</div>
      <div class="fr2">
        <div class="field"><label>Nom d'utilisateur GitHub</label><input id="ghUser" placeholder="ex: jean-dupont"/></div>
        <div class="field"><label>Nom du repo</label><input id="ghRepo" placeholder="ex: mathexcel"/></div>
      </div>
      <div class="field"><label>Token GitHub (stock√© sur cet appareil uniquement)</label><input type="password" id="ghToken" placeholder="ghp_xxxxxxxxxxxx"/></div>
      <div style="display:flex;gap:10px;margin-top:6px;">
        <button class="add-btn" style="flex:1" onclick="testGithub()">üîç Tester la connexion</button>
        <button class="add-btn" style="flex:1" onclick="saveConfig()">‚úÖ Sauvegarder la config</button>
      </div>
      <div id="ghStatus" style="margin-top:10px;padding:10px;border-radius:10px;font-size:13px;display:none;"></div>
    </div>
  </div>

  <!-- √âL√àVES -->
  <div class="panel" id="panel-eleves">
    <div class="section-header"><h2>üë®‚Äçüéì √âl√®ves inscrits</h2></div>
    <div class="student-grid" id="studentGrid"></div>
    <div class="card">
      <div class="card-title">‚ûï Ajouter un √©l√®ve</div>
      <div class="fr2">
        <div class="field"><label>Pr√©nom</label><input id="nName" placeholder="Thomas"/></div>
        <div class="field"><label>Email</label><input type="email" id="nEmail" placeholder="thomas@email.com"/></div>
      </div>
      <div class="fr2">
        <div class="field"><label>Mot de passe</label><input id="nPass" placeholder="maths2025"/></div>
        <div class="field"><label>Couleur avatar</label>
          <select id="nColor">
            <option value="linear-gradient(135deg,#6C3FC5,#8B62D9)">Violet</option>
            <option value="linear-gradient(135deg,#F5C842,#FF9800)">Or</option>
            <option value="linear-gradient(135deg,#2ECC8A,#0080C0)">Emeraude</option>
            <option value="linear-gradient(135deg,#F87171,#FC4A8B)">Rose</option>
            <option value="linear-gradient(135deg,#60A5FA,#3B82F6)">Bleu</option>
          </select>
        </div>
      </div>
      <button class="add-btn" onclick="addStudent()">‚ûï Ajouter</button>
    </div>
  </div>

  <!-- COURS GLOBAL -->
  <div class="panel" id="panel-cours">
    <div class="section-header"><h2>üìö Cours & ressources</h2><p>Commun √† tous les √©l√®ves.</p></div>
    <div class="card">
      <div class="card-header">
        <div class="card-title" style="margin-bottom:0">Chapitres</div>
        <button class="add-btn" style="width:auto;margin:0;padding:7px 14px;" onclick="addChapter()">‚ûï Nouveau</button>
      </div>
      <div id="chapList"></div>
    </div>
  </div>

  <!-- REPLAYS -->
  <div class="panel" id="panel-replays">
    <div class="section-header"><h2>üé• Replays</h2></div>
    <div class="card">
      <div class="card-title">‚ûï Ajouter un replay</div>
      <div class="fr2">
        <div class="field"><label>Titre</label><input id="rTitle" placeholder="S√©ance 13 ‚Äî Limites"/></div>
        <div class="field"><label>Date</label><input id="rDate" placeholder="1 mar 2025"/></div>
      </div>
      <div class="fr2">
        <div class="field"><label>Dur√©e</label><input id="rDur" placeholder="1h30"/></div>
        <div class="field"><label>Lien</label><input type="url" id="rUrl" placeholder="https://drive.google.com/..."/></div>
      </div>
      <button class="add-btn" onclick="addReplay()">‚ûï Ajouter</button>
    </div>
    <div class="card"><div class="card-title">üìã Liste</div><div id="replayList"></div><div id="noReplays" style="display:none;text-align:center;padding:20px;color:var(--muted);font-size:13px;">Aucun replay.</div></div>
  </div>

  <!-- MESSAGE -->
  <div class="panel" id="panel-message">
    <div class="section-header"><h2>üí¨ Message du coach</h2><p>Affich√© dans l'espace objectifs de l'√©l√®ve.</p></div>
    <div class="card">
      <div class="field"><label>Titre</label><input id="msgTitle" placeholder="Semaine du 24 f√©vrier"/></div>
      <div class="field"><label>Message</label><textarea id="msgBody" style="min-height:100px;" placeholder="Beau travail..."></textarea></div>
      <div class="field"><label>Call to action</label><input id="msgCta" placeholder="Objectif : finir les exos avant samedi !"/></div>
      <button class="add-btn" onclick="saveMsg()">‚úÖ Valider</button>
      <div style="margin-top:14px;padding:12px;background:var(--surface2);border-radius:10px;border:1px solid var(--border);">
        <div style="font-size:10px;color:var(--muted);text-transform:uppercase;font-weight:600;letter-spacing:.5px;margin-bottom:7px;">Aper√ßu</div>
        <div id="msgPreview" style="font-size:13px;line-height:1.7;color:var(--muted);">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- VUE √âL√àVE -->
  <div class="panel" id="panel-vue-eleve">
    <div class="section-header"><h2>üëÅÔ∏è Vue par √©l√®ve</h2><p>S√©lectionne un √©l√®ve pour voir tout son profil.</p></div>
    <div class="student-selector" id="vueSelector"></div>
    <div id="vueContent"></div>
  </div>

  <!-- CATEGORIES -->
  <div class="panel" id="panel-categories">
    <div class="section-header"><h2>üè∑Ô∏è Cat√©gories de t√¢ches</h2><p>Personnalise les cat√©gories disponibles dans les plannings. Chaque cat√©gorie a une couleur.</p></div>
    <div class="card">
      <div class="card-title">Cat√©gories actuelles</div>
      <div id="catList"></div>
      <div style="margin-top:12px;padding:14px;background:var(--surface2);border:1px dashed var(--border);border-radius:10px;">
        <div style="font-size:12px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:10px;">Ajouter une cat√©gorie</div>
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
          <input id="newCatName" class="cat-input" style="flex:1;min-width:140px;" placeholder="ex: Bac blanc, Oral..."/>
          <input type="color" id="newCatColor" class="color-pick" value="#A78BFA" title="Couleur du texte"/>
          <input type="color" id="newCatBg" class="color-pick" value="#1a1030" title="Couleur de fond"/>
          <button class="inline-btn" onclick="addCategory()" style="padding:7px 14px;font-size:12px;">Ajouter</button>
        </div>
      </div>
    </div>
  </div>

  <!-- PLANNING PAR √âL√àVE -->
  <div class="panel" id="panel-planning-eleve">
    <div class="section-header"><h2>üóìÔ∏è Planning individuel</h2><p>Chaque √©l√®ve a son propre planning semaine.</p></div>
    <div class="student-selector" id="planSelector"></div>
    <div class="card" id="planContent"><div style="text-align:center;padding:30px;color:var(--muted);font-size:13px;">S√©lectionne un √©l√®ve ci-dessus.</div></div>
  </div>

  <!-- OBJECTIFS PAR √âL√àVE -->
  <div class="panel" id="panel-objectifs-eleve">
    <div class="section-header"><h2>üéØ Objectifs individuels</h2><p>L'√©l√®ve voit uniquement ses objectifs d√©finis ici.</p></div>
    <div class="student-selector" id="objSelector"></div>
    <div id="objContent"><div style="text-align:center;padding:30px;color:var(--muted);font-size:13px;">S√©lectionne un √©l√®ve ci-dessus.</div></div>
  </div>

  <!-- EVALS PAR √âL√àVE -->
  <div class="panel" id="panel-evals-eleve">
    <div class="section-header"><h2>üìä √âvaluations par √©l√®ve</h2></div>
    <div class="student-selector" id="evalSelector"></div>
    <div id="evalContent"><div style="text-align:center;padding:30px;color:var(--muted);font-size:13px;">S√©lectionne un √©l√®ve ci-dessus.</div></div>
  </div>

  <!-- AGENDA PAR √âL√àVE -->
  <div class="panel" id="panel-agenda-eleve">
    <div class="section-header"><h2>üìÖ Agenda & Meet par √©l√®ve</h2></div>
    <div class="student-selector" id="agendaSelector"></div>
    <div id="agendaContent"><div style="text-align:center;padding:30px;color:var(--muted);font-size:13px;">S√©lectionne un √©l√®ve ci-dessus.</div></div>
  </div>
</main>

<div class="toast" id="toast"><span id="toastMsg"></span></div>

<script>
// ‚ïê‚ïê‚ïê AUTH
const ADMIN_PASS='admin2025';
if(sessionStorage.getItem('adminOk')!=='yes'){
  const p=prompt('Mot de passe admin :');
  if(p!==ADMIN_PASS){document.body.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100vh;color:#aaa;font-size:18px;">Acces refuse.</div>';}
  else sessionStorage.setItem('adminOk','yes');
}

// ‚ïê‚ïê‚ïê GITHUB CONFIG
function getCfg(){return JSON.parse(localStorage.getItem('gh_config')||'{}');}
function saveCfg(c){localStorage.setItem('gh_config',JSON.stringify(c));}

// ‚ïê‚ïê‚ïê STATE
let state=null;

const DEFAULT_STUDENT_DATA={
  weekPlan:[{day:'LUN',tasks:[]},{day:'MAR',tasks:[]},{day:'MER',tasks:[]},{day:'JEU',tasks:[]},{day:'VEN',tasks:[]},{day:'SAM',tasks:[]},{day:'DIM',tasks:[]}],
  objectives:[],
  evals:[],
  meetTitle:'',meetDate:'',meetUrl:'',agendaUrl:''
};

const DEFAULT_STATE={
  students:[],
  chapters:[
    {num:1,name:'Suites ‚Äî Raisonnement par recurrence',meta:'Fiche ¬∑ Video ¬∑ Exercices',status:'done',fiche:'',video:'',exercices:''},
    {num:2,name:'Suites ‚Äî Limites',meta:'Fiche ¬∑ Video ¬∑ Exercices',status:'current',fiche:'',video:'',exercices:''},
    {num:3,name:'Suites ‚Äî Operations sur les limites',meta:'Fiche ¬∑ Video ¬∑ Exercices',status:'locked',fiche:'',video:'',exercices:''},
    {num:4,name:'Derivation',meta:'Fiche ¬∑ Video ¬∑ Exercices',status:'done',fiche:'',video:'',exercices:''},
    {num:5,name:'Fonction exponentielle',meta:'Fiche ¬∑ Video ¬∑ Exercices',status:'locked',fiche:'',video:'',exercices:''},
    {num:6,name:'Fonctions trigonometriques',meta:'Fiche ¬∑ Video ¬∑ Exercices',status:'locked',fiche:'',video:'',exercices:''},
    {num:7,name:'Produit scalaire',meta:'Fiche ¬∑ Video ¬∑ Exercices',status:'locked',fiche:'',video:'',exercices:''},
    {num:8,name:'Geometrie reperee',meta:'Fiche ¬∑ Video ¬∑ Exercices',status:'locked',fiche:'',video:'',exercices:''},
    {num:9,name:'Probabilites conditionnelles',meta:'Fiche ¬∑ Video ¬∑ Exercices',status:'done',fiche:'',video:'',exercices:''},
    {num:10,name:'Variables aleatoires',meta:'Fiche ¬∑ Video ¬∑ Exercices',status:'done',fiche:'',video:'',exercices:''},
    {num:11,name:'Loi binomiale',meta:'Fiche ¬∑ Video ¬∑ Exercices',status:'locked',fiche:'',video:'',exercices:''},
    {num:12,name:'Algorithmique Python',meta:'Fiche ¬∑ Video ¬∑ Exercices',status:'locked',fiche:'',video:'',exercices:''},
  ],
  replays:[],
  message:{title:'',body:'',cta:''},
  studentData:{} // keyed by email
};

// ‚ïê‚ïê‚ïê GITHUB API
async function ghFetch(path,method='GET',body=null){
  const cfg=getCfg();
  if(!cfg.token||!cfg.user||!cfg.repo) throw new Error('GitHub non configure');
  const url=`https://api.github.com/repos/${cfg.user}/${cfg.repo}/contents/${path}`;
  const opts={method,headers:{'Authorization':`token ${cfg.token}`,'Content-Type':'application/json','Accept':'application/vnd.github.v3+json'}};
  if(body) opts.body=JSON.stringify(body);
  const r=await fetch(url,opts);
  if(!r.ok){const e=await r.json();throw new Error(e.message||'GitHub error '+r.status);}
  return r.json();
}

async function loadFromGithub(){
  try{
    const res=await ghFetch('data.json');
    // Fix UTF-8 decoding
    const raw=atob(res.content.replace(/\n/g,''));
    const content=JSON.parse(decodeURIComponent(escape(raw)));
    localStorage.setItem('gh_data_sha',res.sha);
    return content;
  }catch(e){
    if(e.message&&e.message.includes('Not Found')) return null;
    throw e;
  }
}

async function saveToGithub(data){
  const cfg=getCfg();
  if(!cfg.token||!cfg.user||!cfg.repo) throw new Error('GitHub non configure ‚Äî va dans Configuration');
  // Proper UTF-8 encoding
  const jsonStr=JSON.stringify(data,null,2);
  const content=btoa(unescape(encodeURIComponent(jsonStr)));
  const sha=localStorage.getItem('gh_data_sha');
  const body={message:'MathExcel admin update',content};
  if(sha) body.sha=sha;
  const res=await ghFetch('data.json','PUT',body);
  if(res.content&&res.content.sha) localStorage.setItem('gh_data_sha',res.content.sha);
}

// ‚ïê‚ïê‚ïê INIT
async function init(){
  const cfg=getCfg();
  if(cfg.user) document.getElementById('ghUser').value=cfg.user;
  if(cfg.repo) document.getElementById('ghRepo').value=cfg.repo;
  if(cfg.token) document.getElementById('ghToken').value=cfg.token;
  if(!cfg.token||!cfg.user||!cfg.repo){state=DEFAULT_STATE;toast('Configure GitHub pour synchroniser','var(--gold)');return;}
  setBtnLoading(true,'Chargement...');
  try{
    const data=await loadFromGithub();
    state=data||DEFAULT_STATE;
    // Ensure studentData exists
    if(!state.studentData) state.studentData={};
    toast('Donnees chargees !','var(--green)');
  }catch(e){
    state=DEFAULT_STATE;
    toast('Erreur GitHub : '+e.message,'var(--red)');
  }
  setBtnLoading(false);
}

function getSD(email){
  if(!state.studentData[email]) state.studentData[email]=JSON.parse(JSON.stringify(DEFAULT_STUDENT_DATA));
  return state.studentData[email];
}

function setBtnLoading(loading,text=''){
  const btn=document.getElementById('saveBtn');
  btn.disabled=loading;
  btn.innerHTML=loading?'‚è≥ '+text:'üíæ Sauvegarder & Publier';
}

// ‚ïê‚ïê‚ïê TOAST
let tt;
function toast(msg,c='var(--green)'){
  const t=document.getElementById('toast');t.style.borderColor=c;t.style.color=c;
  document.getElementById('toastMsg').textContent=msg;t.classList.add('show');
  clearTimeout(tt);tt=setTimeout(()=>t.classList.remove('show'),3000);
}

// ‚ïê‚ïê‚ïê SAVE ALL
async function saveAll(){
  if(!state){toast('Pas de donnees','var(--red)');return;}
  collectFormValues();
  setBtnLoading(true,'Publication...');
  try{
    await saveToGithub(state);
    toast('Publie sur GitHub !','var(--green)');
  }catch(e){
    toast('Erreur : '+e.message,'var(--red)');
  }
  setBtnLoading(false);
}

function collectFormValues(){
  ['msgTitle','msgBody','msgCta'].forEach(id=>{
    const el=document.getElementById(id);
    if(el){const k={msgTitle:'title',msgBody:'body',msgCta:'cta'}[id];state.message[k]=el.value;}
  });
}

// ‚ïê‚ïê‚ïê PANEL NAV
const META={
  config:{title:'Configuration',sub:'Connecte ton repo GitHub'},
  eleves:{title:'Gestion des eleves',sub:'Ajoute, modifie, supprime'},
  cours:{title:'Cours & ressources',sub:'Commun a tous les eleves'},
  replays:{title:'Replays',sub:'Enregistrements des seances'},
  message:{title:'Message du coach',sub:'Affiche dans espace objectifs'},
  'vue-eleve':{title:'Vue par eleve',sub:'Profil complet de chaque eleve'},
  'planning-eleve':{title:'Planning individuel',sub:'Un planning par eleve'},
  'objectifs-eleve':{title:'Objectifs individuels',sub:'Objectifs personnalises par eleve'},
  'evals-eleve':{title:'Evaluations par eleve',sub:'Notes et retours'},
  'agenda-eleve':{title:'Agenda & Meet',sub:'Seance et calendrier par eleve'},
};
function sp(id,el){
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.sb-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('panel-'+id).classList.add('active');
  if(el) el.classList.add('active');
  document.getElementById('pTitle').textContent=META[id]?.title||id;
  document.getElementById('pSub').textContent=META[id]?.sub||'';
  const renders={'eleves':renderStudents,'cours':renderCours,'replays':renderReplays,'message':renderMessage,'vue-eleve':renderVueEleve,'planning-eleve':renderPlanningEleve,'objectifs-eleve':renderObjectifsEleve,'evals-eleve':renderEvalsEleve,'agenda-eleve':renderAgendaEleve,'categories':renderCategories};
  if(renders[id]) renders[id]();
}

// ‚ïê‚ïê‚ïê STUDENT SELECTOR HELPER
function buildSelector(containerId, activeEmail, onSelect){
  const c=document.getElementById(containerId); c.innerHTML='';
  (state.students||[]).forEach(s=>{
    const t=document.createElement('div'); t.className='student-tab'+(s.email===activeEmail?' active':'');
    t.innerHTML=`<div class="av" style="background:${s.color}">${s.name[0]}</div>${s.name}`;
    t.onclick=()=>onSelect(s.email);
    c.appendChild(t);
  });
}

// ‚ïê‚ïê‚ïê STUDENTS
function renderStudents(){
  const g=document.getElementById('studentGrid'); g.innerHTML='';
  (state.students||[]).forEach((s,i)=>{
    const c=document.createElement('div'); c.className='s-card';
    c.innerHTML=`<button class="s-del">‚úï</button>
    <div class="s-top"><div class="s-av" style="background:${s.color}">${s.name[0]}</div><div><div class="s-name">${s.name}</div><div class="s-email">${s.email}</div></div></div>
    <div class="s-field"><label>Prenom</label><input value="${s.name}"/></div>
    <div class="s-field"><label>Email</label><input value="${s.email}"/></div>
    <div class="s-field"><label>Pass</label><input value="${s.pass}"/></div>`;
    c.querySelector('.s-del').onclick=()=>{if(confirm('Supprimer ?')){state.students.splice(i,1);renderStudents();}};
    c.querySelectorAll('.s-field input').forEach((inp,fi)=>{inp.oninput=()=>{state.students[i][['name','email','pass'][fi]]=inp.value;};});
    g.appendChild(c);
  });
}
function addStudent(){
  const name=document.getElementById('nName').value.trim(),email=document.getElementById('nEmail').value.trim(),pass=document.getElementById('nPass').value.trim(),color=document.getElementById('nColor').value;
  if(!name||!email||!pass){toast('Remplis tous les champs','var(--gold)');return;}
  state.students.push({name,email,pass,color});
  if(!state.studentData[email]) state.studentData[email]=JSON.parse(JSON.stringify(DEFAULT_STUDENT_DATA));
  renderStudents();['nName','nEmail','nPass'].forEach(id=>document.getElementById(id).value='');
  toast('Eleve ajoute ! Clique Sauvegarder.');
}

// ‚ïê‚ïê‚ïê COURS
function renderCours(){
  const list=document.getElementById('chapList'); list.innerHTML='';
  (state.chapters||[]).forEach((ch,i)=>{
    const el=document.createElement('div'); el.className='chap-item';
    el.innerHTML=`<div class="chap-num">${ch.num}</div><div class="chap-body">
      <div class="chap-name-row">
        <input class="chap-name-input" value="${ch.name||''}" placeholder="Nom du chapitre"/>
        <select class="chap-status-sel">
          <option value="locked" ${ch.status==='locked'?'selected':''}>Verrouille</option>
          <option value="current" ${ch.status==='current'?'selected':''}>En cours</option>
          <option value="done" ${ch.status==='done'?'selected':''}>Termine</option>
        </select>
        <button class="del-btn">üóë</button>
      </div>
      <div class="chap-links">
        <div class="clf"><label>Fiche</label><input value="${ch.fiche||''}" placeholder="URL Drive..."/></div>
        <div class="clf"><label>Video</label><input value="${ch.video||''}" placeholder="URL YouTube..."/></div>
        <div class="clf"><label>Exos</label><input value="${ch.exercices||''}" placeholder="URL Drive..."/></div>
      </div></div>`;
    el.querySelector('.chap-name-input').oninput=function(){state.chapters[i].name=this.value;};
    el.querySelector('.chap-status-sel').onchange=function(){state.chapters[i].status=this.value;};
    el.querySelector('.del-btn').onclick=()=>{if(confirm('Supprimer ?')){state.chapters.splice(i,1);renderCours();}};
    const links=el.querySelectorAll('.clf input');
    links[0].oninput=function(){state.chapters[i].fiche=this.value;};
    links[1].oninput=function(){state.chapters[i].video=this.value;};
    links[2].oninput=function(){state.chapters[i].exercices=this.value;};
    list.appendChild(el);
  });
}
function addChapter(){
  const num=(state.chapters||[]).length+1;
  state.chapters.push({num,name:'Nouveau chapitre',meta:'Fiche ¬∑ Video ¬∑ Exercices',status:'locked',fiche:'',video:'',exercices:''});
  renderCours();toast('Chapitre ajoute ! Clique Sauvegarder.');
}

// ‚ïê‚ïê‚ïê REPLAYS
function renderReplays(){
  const list=document.getElementById('replayList'); list.innerHTML='';
  const empty=document.getElementById('noReplays');
  if(!(state.replays||[]).length){empty.style.display='block';return;} empty.style.display='none';
  state.replays.forEach((r,i)=>{
    const el=document.createElement('div'); el.className='list-item';
    el.innerHTML=`<div style="font-size:18px">üé•</div><div class="li-info"><div class="li-name">${r.title}</div><div class="li-meta">${r.date} ¬∑ ${r.duration}</div></div><button class="del-btn">üóë</button>`;
    el.querySelector('.del-btn').onclick=()=>{state.replays.splice(i,1);renderReplays();};
    list.appendChild(el);
  });
}
function addReplay(){
  const title=document.getElementById('rTitle').value.trim(),date=document.getElementById('rDate').value.trim(),duration=document.getElementById('rDur').value.trim()||'?',url=document.getElementById('rUrl').value.trim()||'#';
  if(!title||!date){toast('Titre et date requis','var(--gold)');return;}
  state.replays.unshift({title,date,duration,url});renderReplays();
  ['rTitle','rDate','rDur','rUrl'].forEach(id=>document.getElementById(id).value='');
  toast('Ajoute ! Clique Sauvegarder.');
}

// ‚ïê‚ïê‚ïê MESSAGE
function renderMessage(){
  document.getElementById('msgTitle').value=state.message?.title||'';
  document.getElementById('msgBody').value=state.message?.body||'';
  document.getElementById('msgCta').value=state.message?.cta||'';
  updatePreview();
  ['msgTitle','msgBody','msgCta'].forEach(id=>document.getElementById(id).addEventListener('input',updatePreview));
}
function updatePreview(){
  const t=document.getElementById('msgTitle').value||'‚Äî',b=document.getElementById('msgBody').value||'‚Äî',c=document.getElementById('msgCta').value;
  document.getElementById('msgPreview').innerHTML=`<strong style="color:var(--text)">${t}</strong><br/><br/>${b}${c?`<br/><br/><em style="color:var(--accent2)">${c}</em>`:''}`;
}
function saveMsg(){
  state.message={title:document.getElementById('msgTitle').value,body:document.getElementById('msgBody').value,cta:document.getElementById('msgCta').value};
  toast('Message mis a jour. Clique Sauvegarder.');
}

// ‚ïê‚ïê‚ïê VUE ELEVE
let activeVueEmail='';
function renderVueEleve(){
  buildSelector('vueSelector',activeVueEmail,(email)=>{activeVueEmail=email;renderVueEleve();});
  const content=document.getElementById('vueContent');
  if(!activeVueEmail&&state.students.length){activeVueEmail=state.students[0].email;renderVueEleve();return;}
  if(!activeVueEmail){content.innerHTML='<div style="text-align:center;padding:30px;color:var(--muted)">Aucun eleve.</div>';return;}
  const student=state.students.find(s=>s.email===activeVueEmail);
  const sd=getSD(activeVueEmail);
  const chapters=state.chapters||[];
  const done=chapters.filter(c=>c.status==='done').length;
  const avg=sd.evals.length?(sd.evals.reduce((s,e)=>s+(e.note/e.max*20),0)/sd.evals.length).toFixed(1):'‚Äî';
  const objDone=(sd.objectives||[]).filter(o=>o.done).length;
  content.innerHTML=`
    <div style="display:flex;align-items:center;gap:14px;margin-bottom:20px;padding:16px;background:var(--surface);border:1px solid var(--border);border-radius:var(--r);">
      <div style="width:50px;height:50px;border-radius:50%;background:${student.color};display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-weight:800;font-size:20px;color:white">${student.name[0]}</div>
      <div><div style="font-family:'Syne',sans-serif;font-size:18px;font-weight:800">${student.name}</div><div style="font-size:13px;color:var(--muted)">${student.email}</div></div>
    </div>
    <div class="stat-row">
      <div class="mini-stat"><div class="mini-stat-val" style="color:var(--accent2)">${avg}</div><div class="mini-stat-lbl">Moyenne</div></div>
      <div class="mini-stat"><div class="mini-stat-val" style="color:var(--green)">${done}/${chapters.length}</div><div class="mini-stat-lbl">Chapitres</div></div>
      <div class="mini-stat"><div class="mini-stat-val" style="color:var(--gold)">${objDone}/${(sd.objectives||[]).length}</div><div class="mini-stat-lbl">Objectifs</div></div>
    </div>
    <div class="student-overview-grid" id="overviewGrid"></div>`;

  const grid=document.getElementById('overviewGrid');

  // Planning
  const planCard=document.createElement('div'); planCard.className='ov-card';
  planCard.innerHTML=`<div class="ov-title">üóìÔ∏è Planning semaine</div>`;
  const planMini=document.createElement('div'); planMini.className='plan-mini';
  (sd.weekPlan||[]).forEach(d=>{
    if(!d.tasks.length) return;
    const r=document.createElement('div'); r.className='plan-row';
    r.innerHTML=`<span class="plan-day">${d.day}</span><span class="plan-tasks">${d.tasks.map(t=>t.text).join(', ')}</span>`;
    planMini.appendChild(r);
  });
  if(!planMini.children.length) planMini.innerHTML=`<div class="ov-empty">Aucune tache planifiee.</div>`;
  planCard.appendChild(planMini); grid.appendChild(planCard);

  // Objectifs
  const objCard=document.createElement('div'); objCard.className='ov-card';
  objCard.innerHTML=`<div class="ov-title">üéØ Objectifs</div>`;
  (sd.objectives||[]).forEach(o=>{
    const p=document.createElement('div'); p.className='obj-pill';
    p.innerHTML=`<div class="obj-pill-dot ${o.done?'done':'pending'}"></div><span style="${o.done?'text-decoration:line-through;color:var(--muted)':''}">${o.text}</span>`;
    objCard.appendChild(p);
  });
  if(!(sd.objectives||[]).length) objCard.innerHTML+=`<div class="ov-empty">Aucun objectif.</div>`;
  grid.appendChild(objCard);

  // Evals
  const evalCard=document.createElement('div'); evalCard.className='ov-card';
  evalCard.innerHTML=`<div class="ov-title">üìä Evaluations</div>`;
  (sd.evals||[]).slice(0,4).forEach(e=>{
    const p=document.createElement('div'); p.className='eval-pill';
    p.innerHTML=`<span>${e.name}</span><span class="eval-score ${e.noteClass}">${e.note}/${e.max}</span>`;
    evalCard.appendChild(p);
  });
  if(!(sd.evals||[]).length) evalCard.innerHTML+=`<div class="ov-empty">Aucune evaluation.</div>`;
  grid.appendChild(evalCard);

  // Replays vus / s√©ance
  const sessionCard=document.createElement('div'); sessionCard.className='ov-card';
  sessionCard.innerHTML=`<div class="ov-title">üìÖ Seance & Agenda</div>
    ${sd.meetTitle?`<div style="font-size:13px;margin-bottom:8px;"><strong>${sd.meetTitle}</strong><br/><span style="color:var(--muted);font-size:12px">${sd.meetDate||''}</span></div>`:'<div class="ov-empty">Aucune seance configuree.</div>'}
    ${sd.agendaUrl?`<div style="font-size:12px;color:var(--green)">‚úì Agenda connecte</div>`:`<div style="font-size:12px;color:var(--muted)">Agenda non configure</div>`}`;
  grid.appendChild(sessionCard);
}

// ‚ïê‚ïê‚ïê PLANNING PAR ELEVE
let activePlanEmail='';
function renderPlanningEleve(){
  buildSelector('planSelector',activePlanEmail,(email)=>{activePlanEmail=email;renderPlanningEleve();});
  if(!activePlanEmail&&state.students.length){activePlanEmail=state.students[0].email;renderPlanningEleve();return;}
  if(!activePlanEmail) return;
  const sd=getSD(activePlanEmail);
  const student=state.students.find(s=>s.email===activePlanEmail);
  const content=document.getElementById('planContent'); content.innerHTML='';
  const title=document.createElement('div'); title.className='card-title'; title.textContent=`Planning de ${student.name}`;
  content.appendChild(title);
  const grid=document.createElement('div'); grid.className='week-grid';
  sd.weekPlan.forEach((day,di)=>{
    const row=document.createElement('div'); row.className='wg-row';
    const label=document.createElement('div'); label.className='wg-day'; label.textContent=day.day;
    const tasks=document.createElement('div'); tasks.className='wg-tasks';
    function refresh(){
      tasks.innerHTML='';
      day.tasks.forEach((t,ti)=>{
        const chip=document.createElement('span');
        const cat=getCatByKey(t.type);
        chip.className='task-chip';
        chip.style.background=cat.bg; chip.style.color=cat.color;
        chip.innerHTML=`${t.text}<button class="chip-del">‚úï</button>`;
        chip.querySelector('.chip-del').onclick=()=>{day.tasks.splice(ti,1);refresh();};
        tasks.appendChild(chip);
      });
      const ar=document.createElement('div'); ar.className='add-task-row';
      const cats=getCategories();
      const opts=cats.map(c=>`<option value="${c.key}">${c.name}</option>`).join('');
      ar.innerHTML=`<input class="at-input" placeholder="Ajouter..."/><select class="at-select">${opts}</select><button class="at-btn">+</button>`;
      ar.querySelector('.at-btn').onclick=()=>{const v=ar.querySelector('input').value.trim();if(!v)return;day.tasks.push({text:v,type:ar.querySelector('select').value});refresh();};
      tasks.appendChild(ar);
    }
    refresh(); row.appendChild(label); row.appendChild(tasks); grid.appendChild(row);
  });
  content.appendChild(grid);
}

// ‚ïê‚ïê‚ïê OBJECTIFS PAR ELEVE
let activeObjEmail='';
function renderObjectifsEleve(){
  buildSelector('objSelector',activeObjEmail,(email)=>{activeObjEmail=email;renderObjectifsEleve();});
  if(!activeObjEmail&&state.students.length){activeObjEmail=state.students[0].email;renderObjectifsEleve();return;}
  if(!activeObjEmail) return;
  const sd=getSD(activeObjEmail);
  const student=state.students.find(s=>s.email===activeObjEmail);
  const content=document.getElementById('objContent'); content.innerHTML='';
  const card=document.createElement('div'); card.className='card';
  card.innerHTML=`<div class="card-title">Objectifs de ${student.name}</div>`;
  function renderObjs(){
    card.querySelectorAll('.obj-item').forEach(e=>e.remove());
    card.querySelector('.inline-row')?.remove();
    (sd.objectives||[]).forEach((o,i)=>{
      const el=document.createElement('div'); el.className='obj-item';
      el.innerHTML=`<div class="obj-dot" style="background:${o.done?'var(--green)':'var(--muted)'}"></div><span style="flex:1;${o.done?'text-decoration:line-through;color:var(--muted)':''}">${o.text}</span>
        <button style="background:none;border:none;cursor:pointer;font-size:12px;color:var(--muted);padding:2px 6px;border-radius:6px;" onclick="toggleObj('${activeObjEmail}',${i})">${o.done?'‚Ü© Remettre':'‚úì Marquer fait'}</button>
        <button class="del-btn">üóë</button>`;
      el.querySelector('.del-btn').onclick=()=>{sd.objectives.splice(i,1);renderObjs();};
      card.appendChild(el);
    });
    if(!(sd.objectives||[]).length){const em=document.createElement('div');em.style.cssText='text-align:center;padding:16px;color:var(--muted);font-size:13px';em.textContent='Aucun objectif.';card.appendChild(em);}
    const row=document.createElement('div'); row.className='inline-row';
    row.innerHTML=`<input class="inline-input" id="newObjInput" placeholder="Nouvel objectif pour ${student.name}..."/><button class="inline-btn" onclick="addObjForStudent('${activeObjEmail}')">Ajouter</button>`;
    card.appendChild(row);
  }
  renderObjs(); content.appendChild(card);
}

function toggleObj(email,i){
  const sd=getSD(email); sd.objectives[i].done=!sd.objectives[i].done;
  renderObjectifsEleve();
}

function addObjForStudent(email){
  const inp=document.getElementById('newObjInput');
  const text=inp.value.trim(); if(!text) return;
  const sd=getSD(email); sd.objectives=sd.objectives||[];
  sd.objectives.push({text,done:false,source:'coach'});
  inp.value=''; renderObjectifsEleve();
  toast('Objectif ajoute ! Clique Sauvegarder.');
}

// ‚ïê‚ïê‚ïê EVALS PAR ELEVE
let activeEvalEmail='';
function renderEvalsEleve(){
  buildSelector('evalSelector',activeEvalEmail,(email)=>{activeEvalEmail=email;renderEvalsEleve();});
  if(!activeEvalEmail&&state.students.length){activeEvalEmail=state.students[0].email;renderEvalsEleve();return;}
  if(!activeEvalEmail) return;
  const sd=getSD(activeEvalEmail);
  const student=state.students.find(s=>s.email===activeEvalEmail);
  const content=document.getElementById('evalContent'); content.innerHTML='';

  // Add form
  const form=document.createElement('div'); form.className='card';
  form.innerHTML=`<div class="card-title">Ajouter une evaluation pour ${student.name}</div>
    <div class="fr2">
      <div class="field"><label>Nom du DS</label><input id="seeName" placeholder="DS Suites"/></div>
      <div class="field"><label>Date</label><input id="seeDate" placeholder="1 mar 2025"/></div>
    </div>
    <div class="fr3">
      <div class="field"><label>Note</label><input type="number" id="seeNote" placeholder="15" min="0" max="20"/></div>
      <div class="field"><label>Sur</label><input type="number" id="seeMax" value="20"/></div>
      <div class="field"><label>Couleur</label><select id="seeClass"><option value="good">Bon</option><option value="ok">Moyen</option><option value="bad">A retravailler</option></select></div>
    </div>
    <div class="field"><label>Commentaire</label><textarea id="seeComment" placeholder="Retour..."></textarea></div>
    <div class="field"><label>Tags</label><input id="seeTags" placeholder="Recursion, Methode..."/></div>
    <button class="add-btn" onclick="addEvalForStudent('${activeEvalEmail}')">Ajouter</button>`;
  content.appendChild(form);

  // List
  const list=document.createElement('div'); list.className='card';
  list.innerHTML=`<div class="card-title">Historique de ${student.name}</div>`;
  if(!(sd.evals||[]).length){list.innerHTML+=`<div style="text-align:center;padding:20px;color:var(--muted);font-size:13px;">Aucune evaluation.</div>`;}
  (sd.evals||[]).forEach((e,i)=>{
    const el=document.createElement('div'); el.className='list-item';
    el.innerHTML=`<div style="font-size:18px">üìä</div><div class="li-info"><div class="li-name">${e.name}</div><div class="li-meta">${e.date} ¬∑ ${e.comment?e.comment.slice(0,40)+'...':''}</div></div><span class="badge ${e.noteClass==='good'?'b-done':e.noteClass==='ok'?'b-ok':''}">${e.note}/${e.max}</span><button class="del-btn">üóë</button>`;
    el.querySelector('.del-btn').onclick=()=>{sd.evals.splice(i,1);renderEvalsEleve();};
    list.appendChild(el);
  });
  content.appendChild(list);
}

function addEvalForStudent(email){
  const name=document.getElementById('seeName').value.trim(),date=document.getElementById('seeDate').value.trim(),note=parseFloat(document.getElementById('seeNote').value),max=parseFloat(document.getElementById('seeMax').value)||20,noteClass=document.getElementById('seeClass').value,comment=document.getElementById('seeComment').value.trim(),tagsRaw=document.getElementById('seeTags').value.trim();
  if(!name||!date||isNaN(note)){toast('Nom, date et note requis','var(--gold)');return;}
  const sd=getSD(email); sd.evals=sd.evals||[];
  sd.evals.unshift({name,date,note,max,noteClass,comment,tags:tagsRaw?tagsRaw.split(',').map(t=>t.trim()):[]});
  ['seeName','seeDate','seeNote','seeComment','seeTags'].forEach(id=>document.getElementById(id).value=''); document.getElementById('seeMax').value='20';
  renderEvalsEleve(); toast('Evaluation ajoutee ! Clique Sauvegarder.');
}

// ‚ïê‚ïê‚ïê AGENDA PAR ELEVE
let activeAgendaEmail='';
function renderAgendaEleve(){
  buildSelector('agendaSelector',activeAgendaEmail,(email)=>{activeAgendaEmail=email;renderAgendaEleve();});
  if(!activeAgendaEmail&&state.students.length){activeAgendaEmail=state.students[0].email;renderAgendaEleve();return;}
  if(!activeAgendaEmail) return;
  const sd=getSD(activeAgendaEmail);
  const student=state.students.find(s=>s.email===activeAgendaEmail);
  const c=document.getElementById('agendaContent'); c.innerHTML='';

  // Extract stored datetime parts
  const storedDt = sd.meetDatetime||'';
  const storedTimeEnd = sd.meetTimeEnd||'15:30';

  const card=document.createElement('div'); card.className='card';
  card.innerHTML=`
    <div class="card-title" style="margin-bottom:16px;">üìπ S√©ance Google Meet ‚Äî ${student.name}</div>
    <div class="field"><label>Titre de la s√©ance</label><input id="smTitle" value="${sd.meetTitle||''}" placeholder="Limites de suites ‚Äî Chapitre 2"/></div>
    <div class="fr3">
      <div class="field"><label>Date</label><input type="date" id="smDatePicker" value="${storedDt.split('T')[0]||''}"/></div>
      <div class="field"><label>D√©but</label><input type="time" id="smTimeStart" value="${storedDt.split('T')[1]||'14:00'}"/></div>
      <div class="field"><label>Fin</label><input type="time" id="smTimeEnd" value="${storedTimeEnd}"/></div>
    </div>
    <div class="field">
      <label>Lien Google Meet</label>
      <div style="display:flex;gap:8px;align-items:center;">
        <input type="url" id="smUrl" value="${sd.meetUrl||''}" placeholder="https://meet.google.com/..." style="flex:1"/>
        <button onclick="generateMeetLink()" style="background:linear-gradient(135deg,#4285F4,#34A853);color:white;border:none;border-radius:8px;padding:9px 14px;font-size:12px;font-weight:600;cursor:pointer;white-space:nowrap;flex-shrink:0;">‚ú® G√©n√©rer Meet</button>
      </div>
      <div id="meetGenStatus" style="margin-top:6px;font-size:12px;color:var(--muted);display:none;"></div>
    </div>
    <div style="display:flex;gap:8px;margin-top:4px;">
      <button class="add-btn" style="flex:1" onclick="saveMeet('${activeAgendaEmail}')">‚úÖ Valider la s√©ance</button>
    </div>
    ${sd.meetUrl ? `<div style="margin-top:12px;padding:10px 14px;background:rgba(52,211,153,.1);border:1px solid rgba(52,211,153,.3);border-radius:10px;font-size:13px;color:var(--green);">
      ‚úÖ S√©ance configur√©e ¬∑ <strong>${sd.meetTitle||''}</strong> ¬∑ ${formatMeetDisplay(sd.meetDatetime, sd.meetTimeEnd)}
      <a href="${sd.meetUrl}" target="_blank" style="color:var(--blue);margin-left:8px;font-size:12px;">Ouvrir ‚Üí</a>
    </div>` : ''}`;
  c.appendChild(card);
}

function formatMeetDisplay(dt, timeEnd){
  if(!dt) return '';
  const d = new Date(dt);
  const days = ['Dim','Lun','Mar','Mer','Jeu','Ven','Sam'];
  const months = ['jan','fev','mar','avr','mai','juin','juil','aout','sep','oct','nov','dec'];
  const timeStart = dt.split('T')[1]||'14:00';
  return `${days[d.getDay()]} ${d.getDate()} ${months[d.getMonth()]} ¬∑ ${timeStart} ‚Äì ${timeEnd||'15:30'}`;
}

async function generateMeetLink(){
  const statusEl = document.getElementById('meetGenStatus');
  statusEl.style.display='block'; statusEl.style.color='var(--muted)'; statusEl.textContent='‚è≥ G√©n√©ration en cours...';
  const adminToken = localStorage.getItem('admin_gcal_token');
  if(!adminToken){
    statusEl.style.color='var(--gold)';
    statusEl.innerHTML='‚ö†Ô∏è Connecte ton Google d'abord. <button onclick="adminConnectGoogle()" style="background:linear-gradient(135deg,#4285F4,#34A853);color:white;border:none;border-radius:6px;padding:4px 10px;font-size:11px;cursor:pointer;margin-left:6px;">Connecter Google ‚Üí</button>';
    return;
  }
  try {
    // Create a temporary Calendar event with Meet conferencing ‚Äî Google generates a Meet link
    const titleVal = document.getElementById('smTitle')?.value || 'S√©ance MathExcel';
    const dateVal = document.getElementById('smDatePicker')?.value || new Date().toISOString().split('T')[0];
    const timeStart = document.getElementById('smTimeStart')?.value || '14:00';
    const timeEnd = document.getElementById('smTimeEnd')?.value || '15:30';
    const startDt = dateVal + 'T' + timeStart + ':00';
    const endDt = dateVal + 'T' + timeEnd + ':00';
    const event = {
      summary: 'üéì ' + titleVal,
      start: { dateTime: startDt, timeZone: 'Europe/Paris' },
      end:   { dateTime: endDt,   timeZone: 'Europe/Paris' },
      conferenceData: { createRequest: { requestId: 'mathexcel-' + Date.now(), conferenceSolutionKey: { type: 'hangoutsMeet' } } }
    };
    const r = await fetch('https://www.googleapis.com/calendar/v3/calendars/primary/events?conferenceDataVersion=1', {
      method: 'POST',
      headers: { 'Authorization': 'Bearer ' + adminToken, 'Content-Type': 'application/json' },
      body: JSON.stringify(event)
    });
    if(r.status===401){ localStorage.removeItem('admin_gcal_token'); statusEl.style.color='var(--red)'; statusEl.textContent='Session expir√©e ‚Äî reconnecte-toi.'; return; }
    if(!r.ok){ const e=await r.json(); throw new Error(e.error?.message||'Erreur '+r.status); }
    const data = await r.json();
    const meetUrl = data.conferenceData?.entryPoints?.find(e=>e.entryPointType==='video')?.uri || data.hangoutLink;
    if(!meetUrl) throw new Error('Pas de lien Meet dans la r√©ponse');
    document.getElementById('smUrl').value = meetUrl;
    statusEl.style.color='var(--green)'; statusEl.textContent='‚úÖ Lien Meet g√©n√©r√© ! (√©v√©nement cr√©√© dans ton agenda)';
  } catch(e){
    statusEl.style.color='var(--red)'; statusEl.textContent='Erreur : '+e.message;
  }
}

function adminConnectGoogle(){
  const GCAL_CLIENT_ID = '781377125018-kbct6snli56jku4tp4368rcncmca2omt.apps.googleusercontent.com';
  const SCOPE = 'https://www.googleapis.com/auth/calendar.events';
  const REDIRECT = window.location.origin + '/admin.html';
  const params = new URLSearchParams({client_id:GCAL_CLIENT_ID,redirect_uri:REDIRECT,response_type:'token',scope:SCOPE,prompt:'consent',state:'admin_gcal'});
  window.location.href='https://accounts.google.com/o/oauth2/auth?'+params.toString();
}

function handleAdminOAuth(){
  const hash=window.location.hash;
  if(!hash) return;
  const params=new URLSearchParams(hash.substring(1));
  const token=params.get('access_token'), st=params.get('state');
  if(token&&st==='admin_gcal'){
    localStorage.setItem('admin_gcal_token',token);
    window.history.replaceState({},document.title,window.location.pathname);
    toast('‚úÖ Google connect√© ! Tu peux g√©n√©rer des liens Meet.','var(--green)');
  }
}

function saveMeet(email){
  const sd=getSD(email);
  const dateVal=document.getElementById('smDatePicker').value;
  const timeStart=document.getElementById('smTimeStart').value||'14:00';
  const timeEnd=document.getElementById('smTimeEnd').value||'15:30';
  sd.meetTitle=document.getElementById('smTitle').value;
  sd.meetDatetime=dateVal?dateVal+'T'+timeStart:'';
  sd.meetTimeEnd=timeEnd;
  sd.meetUrl=document.getElementById('smUrl').value;
  // Build human-readable string for display
  if(dateVal){
    const d=new Date(dateVal+'T12:00:00');
    const days=['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'];
    const months=['jan','fev','mar','avr','mai','juin','juil','aout','sep','oct','nov','dec'];
    sd.meetDate=`${days[d.getDay()]} ${d.getDate()} ${months[d.getMonth()]} ¬∑ ${timeStart.replace(':','h')} ‚Äì ${timeEnd.replace(':','h')}`;
  }
  renderAgendaEleve();
  toast('Seance mise a jour ! Clique Sauvegarder.');
}

// ‚ïê‚ïê‚ïê CONFIG
async function testGithub(){
  const user=document.getElementById('ghUser').value.trim(),repo=document.getElementById('ghRepo').value.trim(),token=document.getElementById('ghToken').value.trim();
  if(!user||!repo||!token){toast('Remplis tous les champs','var(--gold)');return;}
  const st=document.getElementById('ghStatus');
  st.style.display='block';st.style.cssText+='background:rgba(124,92,252,.1);border:1px solid rgba(124,92,252,.3);color:var(--accent2);';
  st.textContent='Test en cours...';
  try{
    const r=await fetch(`https://api.github.com/repos/${user}/${repo}`,{headers:{'Authorization':`token ${token}`}});
    const d=await r.json();
    if(r.ok){st.style.background='rgba(52,211,153,.1)';st.style.border='1px solid rgba(52,211,153,.3)';st.style.color='var(--green)';st.textContent='Connexion reussie ! Repo : '+d.full_name;}
    else{st.style.background='rgba(248,113,113,.1)';st.style.color='var(--red)';st.textContent='Erreur : '+d.message;}
  }catch(e){st.style.color='var(--red)';st.textContent='Erreur reseau : '+e.message;}
}
function saveConfig(){
  const user=document.getElementById('ghUser').value.trim(),repo=document.getElementById('ghRepo').value.trim(),token=document.getElementById('ghToken').value.trim();
  if(!user||!repo||!token){toast('Remplis tous les champs','var(--gold)');return;}
  saveCfg({user,repo,token}); toast('Config sauvegardee !','var(--green)');
  setTimeout(()=>location.reload(),1200);
}

// ‚îÄ‚îÄ CATEGORIES
const DEFAULT_CATEGORIES = [
  {key:'cours',name:'Cours / S√©ance',color:'#A78BFA',bg:'rgba(124,92,252,.2)'},
  {key:'exo',name:'Exercices',color:'#34D399',bg:'rgba(52,211,153,.15)'},
  {key:'revise',name:'R√©vision',color:'#F5C842',bg:'rgba(245,200,66,.12)'},
  {key:'lecture',name:'Lecture / Fiche',color:'#60A5FA',bg:'rgba(96,165,250,.15)'},
  {key:'devoir',name:'Devoir / DS',color:'#F87171',bg:'rgba(248,113,113,.15)'},
];

function getCategories(){
  if(!state.categories || !state.categories.length) state.categories=JSON.parse(JSON.stringify(DEFAULT_CATEGORIES));
  return state.categories;
}

function getCatByKey(key){
  const cats=getCategories();
  return cats.find(c=>c.key===key) || {color:'#A78BFA',bg:'rgba(167,139,250,.15)',name:key};
}

function renderCategories(){
  const list=document.getElementById('catList'); if(!list) return;
  list.innerHTML='';
  getCategories().forEach((cat,i)=>{
    const el=document.createElement('div');
    el.style.cssText='display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;margin-bottom:7px;';
    el.innerHTML=`
      <span style="display:inline-flex;align-items:center;padding:4px 12px;border-radius:6px;font-size:12px;font-weight:600;background:${cat.bg};color:${cat.color}">${cat.name}</span>
      <span style="flex:1;font-size:12px;color:var(--muted)">Couleur texte: <span style="color:${cat.color};font-weight:600">${cat.color}</span></span>
      <input type="color" value="${cat.color}" title="Couleur texte" style="width:24px;height:24px;border:none;border-radius:4px;cursor:pointer;padding:0;background:none;" oninput="state.categories[${i}].color=this.value;renderCategories()"/>
      <input type="color" value="${cat.bg.startsWith('rgba')?rgbaToHex(cat.bg):cat.bg}" title="Couleur fond" style="width:24px;height:24px;border:none;border-radius:4px;cursor:pointer;padding:0;background:none;" oninput="state.categories[${i}].bg=hexToRgba(this.value,.15);renderCategories()"/>
      <button style="background:none;border:none;cursor:pointer;color:var(--muted);font-size:13px;padding:4px 6px;border-radius:6px;" onmouseover="this.style.color='var(--red)'" onmouseout="this.style.color='var(--muted)'" onclick="delCategory(${i})">üóë</button>`;
    list.appendChild(el);
  });
}

function addCategory(){
  const name=document.getElementById('newCatName').value.trim();
  const color=document.getElementById('newCatColor').value;
  const bgHex=document.getElementById('newCatBg').value;
  if(!name){toast('Donne un nom √† la cat√©gorie','var(--gold)');return;}
  const key='cat_'+Date.now();
  state.categories=getCategories();
  state.categories.push({key,name,color,bg:hexToRgba(bgHex,.15)});
  renderCategories();
  document.getElementById('newCatName').value='';
  toast('Cat√©gorie ajout√©e ! Clique Sauvegarder.');
}

function delCategory(i){
  if(!confirm('Supprimer cette cat√©gorie ?')) return;
  state.categories.splice(i,1); renderCategories();
}

function hexToRgba(hex, alpha){
  const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);
  return `rgba(${r},${g},${b},${alpha})`;
}

function rgbaToHex(rgba){
  const m=rgba.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);
  if(!m) return '#7C5CFC';
  return '#'+[m[1],m[2],m[3]].map(x=>parseInt(x).toString(16).padStart(2,'0')).join('');
}

// Add categories to META
META['categories']={title:'Cat√©gories de t√¢ches',sub:'Personnalise les √©tiquettes du planning'};

handleAdminOAuth();
init();
</script>
</body>
</html>
