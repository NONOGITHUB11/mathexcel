<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MathExcel â€” Administration</title>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,400&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0A0A0F;
      --surface: #111118;
      --surface2: #18181F;
      --surface3: #22222C;
      --border: rgba(255,255,255,0.07);
      --border-hover: rgba(255,255,255,0.12);
      --text: #F2F2F5;
      --muted: #7A7A8C;
      --accent: #7C5CFC;
      --accent2: #A78BFA;
      --gold: #F5C842;
      --green: #34D399;
      --red: #F87171;
      --blue: #60A5FA;
      --glow: rgba(124,92,252,0.2);
      --r: 14px;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
    }

    /* Grid background */
    body::before {
      content: '';
      position: fixed; inset: 0;
      background-image:
        linear-gradient(rgba(124,92,252,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(124,92,252,0.03) 1px, transparent 1px);
      background-size: 32px 32px;
      pointer-events: none; z-index: 0;
    }

    /* â”€â”€ SIDEBAR â”€â”€ */
    .sidebar {
      width: 220px; flex-shrink: 0;
      background: var(--surface);
      border-right: 1px solid var(--border);
      display: flex; flex-direction: column;
      padding: 24px 0;
      position: sticky; top: 0; height: 100vh;
      z-index: 10;
    }
    .sb-logo {
      padding: 0 20px 24px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 16px;
    }
    .sb-logo-mark {
      width: 38px; height: 38px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-family: 'Syne', sans-serif;
      font-size: 14px; font-weight: 800; color: white;
      margin-bottom: 10px;
      box-shadow: 0 4px 16px var(--glow);
    }
    .sb-title { font-family: 'Syne', sans-serif; font-size: 16px; font-weight: 800; }
    .sb-sub   { font-size: 11px; color: var(--muted); margin-top: 2px; }

    .sb-section {
      font-size: 10px; font-weight: 700;
      letter-spacing: 1.5px; text-transform: uppercase;
      color: var(--muted);
      padding: 12px 20px 6px;
    }
    .sb-item {
      display: flex; align-items: center; gap: 10px;
      padding: 9px 20px;
      font-size: 13px; font-weight: 500;
      color: var(--muted);
      cursor: pointer;
      border-radius: 0;
      transition: all 0.15s;
      border-left: 2px solid transparent;
      text-decoration: none;
    }
    .sb-item:hover { color: var(--text); background: var(--surface2); }
    .sb-item.active { color: var(--text); background: rgba(124,92,252,0.1); border-left-color: var(--accent); }
    .sb-item .ico { font-size: 15px; width: 18px; text-align: center; }

    .sb-footer {
      margin-top: auto;
      padding: 16px 20px 0;
      border-top: 1px solid var(--border);
    }
    .sb-view-btn {
      display: flex; align-items: center; gap: 8px;
      width: 100%;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 12px;
      color: var(--muted);
      font-size: 12px; font-weight: 500;
      cursor: pointer; text-decoration: none;
      transition: all 0.15s;
    }
    .sb-view-btn:hover { color: var(--text); border-color: var(--border-hover); }

    /* â”€â”€ MAIN â”€â”€ */
    .main {
      flex: 1; min-width: 0;
      position: relative; z-index: 1;
    }

    .topbar {
      padding: 20px 32px;
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between;
      background: rgba(10,10,15,0.85);
      backdrop-filter: blur(12px);
      position: sticky; top: 0; z-index: 5;
    }
    .topbar h1 { font-family: 'Syne', sans-serif; font-size: 20px; font-weight: 800; }
    .topbar p  { font-size: 12px; color: var(--muted); margin-top: 2px; }

    .save-btn {
      display: flex; align-items: center; gap: 8px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: white; border: none;
      border-radius: 10px; padding: 10px 20px;
      font-family: 'Syne', sans-serif; font-size: 13px; font-weight: 700;
      cursor: pointer; transition: all 0.15s;
      box-shadow: 0 4px 16px var(--glow);
    }
    .save-btn:hover { transform: translateY(-1px); box-shadow: 0 8px 24px var(--glow); }
    .save-btn:active { transform: translateY(0); }

    /* â”€â”€ PANELS â”€â”€ */
    .panel { display: none; padding: 32px; }
    .panel.active { display: block; }

    /* â”€â”€ TOAST â”€â”€ */
    .toast {
      position: fixed; bottom: 28px; right: 28px;
      background: var(--surface2); border: 1px solid var(--green);
      color: var(--green); border-radius: 12px;
      padding: 14px 20px; font-size: 14px; font-weight: 500;
      display: flex; align-items: center; gap: 10px;
      transform: translateY(80px); opacity: 0;
      transition: all 0.3s cubic-bezier(.34,1.56,.64,1);
      z-index: 100;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    }
    .toast.show { transform: translateY(0); opacity: 1; }

    /* â”€â”€ SECTION TITLE â”€â”€ */
    .section-header {
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }
    .section-header h2 { font-family: 'Syne', sans-serif; font-size: 18px; font-weight: 700; }
    .section-header p  { font-size: 13px; color: var(--muted); margin-top: 4px; }

    /* â”€â”€ CARDS â”€â”€ */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--r);
      padding: 24px;
      margin-bottom: 20px;
    }
    .card-title {
      font-family: 'Syne', sans-serif; font-size: 15px; font-weight: 700;
      margin-bottom: 16px;
      display: flex; align-items: center; gap: 8px;
    }

    /* â”€â”€ FORM ELEMENTS â”€â”€ */
    .field { margin-bottom: 16px; }
    .field label {
      display: block; font-size: 12px; font-weight: 600;
      letter-spacing: 0.5px; color: var(--muted);
      text-transform: uppercase; margin-bottom: 7px;
    }
    .field input, .field textarea, .field select {
      width: 100%;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 11px 14px;
      font-family: 'DM Sans', sans-serif; font-size: 14px;
      color: var(--text); outline: none;
      transition: border-color 0.15s, box-shadow 0.15s;
    }
    .field input:focus, .field textarea:focus, .field select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--glow);
    }
    .field input::placeholder, .field textarea::placeholder { color: var(--muted); }
    .field textarea { resize: vertical; min-height: 80px; }
    .field select option { background: var(--surface2); }

    .field-row { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    .field-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 14px; }

    /* â”€â”€ SYNC BUTTON â”€â”€ */
    .sync-btn {
      display: flex; align-items: center; gap: 10px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 12px; padding: 14px 18px;
      color: var(--text); font-size: 14px; font-weight: 500;
      cursor: pointer; transition: all 0.15s; width: 100%;
      margin-bottom: 12px;
    }
    .sync-btn:hover { border-color: var(--accent); background: rgba(124,92,252,0.08); }
    .sync-btn .sync-icon { font-size: 20px; }
    .sync-btn .sync-info { flex: 1; text-align: left; }
    .sync-btn .sync-label { font-weight: 600; }
    .sync-btn .sync-sub   { font-size: 12px; color: var(--muted); margin-top: 2px; }
    .sync-btn .sync-arrow { color: var(--accent); font-size: 16px; }
    .sync-btn.connected   { border-color: var(--green); background: rgba(52,211,153,0.06); }
    .sync-btn.connected .sync-arrow { color: var(--green); }

    /* â”€â”€ ADD FORM CARD â”€â”€ */
    .add-form {
      background: var(--surface2);
      border: 1px dashed var(--border);
      border-radius: var(--r);
      padding: 20px;
      margin-bottom: 16px;
    }
    .add-form-title {
      font-size: 13px; font-weight: 600;
      color: var(--muted); margin-bottom: 16px;
      display: flex; align-items: center; gap: 8px;
    }

    /* â”€â”€ LIST ITEMS â”€â”€ */
    .list-items { display: flex; flex-direction: column; gap: 8px; }
    .list-item {
      display: flex; align-items: center; gap: 12px;
      padding: 12px 14px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 10px;
      transition: border-color 0.15s;
    }
    .list-item:hover { border-color: var(--border-hover); }
    .list-item-icon { font-size: 20px; flex-shrink: 0; }
    .list-item-info { flex: 1; min-width: 0; }
    .list-item-name {
      font-size: 14px; font-weight: 500;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .list-item-meta { font-size: 12px; color: var(--muted); margin-top: 2px; }
    .list-item-badge {
      font-size: 11px; font-weight: 600;
      padding: 3px 9px; border-radius: 20px;
      flex-shrink: 0;
    }
    .badge-good   { background: rgba(52,211,153,0.15); color: var(--green); }
    .badge-ok     { background: rgba(245,200,66,0.15); color: var(--gold); }
    .badge-bad    { background: rgba(248,113,113,0.15); color: var(--red); }
    .badge-active { background: rgba(124,92,252,0.2); color: var(--accent2); }
    .badge-done   { background: rgba(52,211,153,0.1); color: var(--green); }
    .badge-locked { background: var(--surface3); color: var(--muted); }

    .del-btn {
      background: none; border: none; color: var(--muted);
      cursor: pointer; padding: 4px 8px; border-radius: 6px;
      font-size: 14px; transition: all 0.15s; flex-shrink: 0;
    }
    .del-btn:hover { background: rgba(248,113,113,0.1); color: var(--red); }

    .add-item-btn {
      display: flex; align-items: center; justify-content: center; gap: 8px;
      width: 100%; padding: 11px;
      background: none;
      border: 1px dashed var(--border);
      border-radius: 10px;
      color: var(--muted); font-size: 13px; font-weight: 500;
      cursor: pointer; transition: all 0.15s; margin-top: 8px;
    }
    .add-item-btn:hover { border-color: var(--accent); color: var(--accent2); background: rgba(124,92,252,0.05); }

    /* â”€â”€ STUDENT CARDS â”€â”€ */
    .student-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 14px; margin-bottom: 16px; }
    .student-card {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      position: relative;
    }
    .student-card:hover { border-color: var(--border-hover); }
    .student-card-top {
      display: flex; align-items: center; gap: 12px; margin-bottom: 12px;
    }
    .student-avatar {
      width: 40px; height: 40px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-family: 'Syne', sans-serif; font-weight: 700; font-size: 16px; color: white;
      flex-shrink: 0;
    }
    .student-card-name { font-size: 15px; font-weight: 600; }
    .student-card-email { font-size: 12px; color: var(--muted); }
    .student-card-del {
      position: absolute; top: 10px; right: 10px;
      background: none; border: none; color: var(--muted);
      cursor: pointer; padding: 4px; border-radius: 6px; font-size: 14px;
      transition: all 0.15s;
    }
    .student-card-del:hover { background: rgba(248,113,113,0.1); color: var(--red); }

    .student-field {
      display: flex; align-items: center; gap: 8px;
      margin-bottom: 8px;
    }
    .student-field label { font-size: 11px; color: var(--muted); width: 60px; flex-shrink: 0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; }
    .student-field input {
      flex: 1; background: var(--surface); border: 1px solid var(--border);
      border-radius: 8px; padding: 7px 10px;
      font-size: 13px; color: var(--text);
      font-family: 'DM Sans', sans-serif; outline: none;
      transition: border-color 0.15s;
    }
    .student-field input:focus { border-color: var(--accent); }

    /* â”€â”€ AGENDA PREVIEW â”€â”€ */
    .agenda-preview {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      margin-top: 16px;
    }
    .agenda-preview iframe { display: block; width: 100%; height: 350px; border: 0; }
    .agenda-placeholder {
      height: 200px;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      gap: 12px; color: var(--muted); font-size: 14px;
    }

    /* â”€â”€ MEET CARD â”€â”€ */
    .meet-status {
      display: flex; align-items: center; gap: 10px;
      padding: 12px 14px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 10px;
      margin-top: 12px;
      font-size: 13px;
    }
    .meet-dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: var(--muted); flex-shrink: 0;
    }
    .meet-dot.active { background: var(--green); box-shadow: 0 0 6px var(--green); }

    /* â”€â”€ WEEK PLANNER â”€â”€ */
    .week-grid {
      display: grid; grid-template-columns: 60px 1fr;
      gap: 0;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
    }
    .week-day-label {
      font-size: 11px; font-weight: 700;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      color: var(--muted);
      padding: 12px 0 12px 16px;
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center;
    }
    .week-day-label:last-of-type { border-bottom: none; }
    .week-day-tasks {
      padding: 8px 12px;
      border-bottom: 1px solid var(--border);
      display: flex; flex-wrap: wrap; gap: 6px; align-items: center;
    }
    .week-day-tasks:last-of-type { border-bottom: none; }
    .task-chip {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 4px 10px; border-radius: 6px;
      font-size: 12px; background: var(--surface3);
      color: var(--text);
    }
    .task-chip.cours  { background: rgba(124,92,252,0.2); color: var(--accent2); }
    .task-chip.exo    { background: rgba(52,211,153,0.15); color: var(--green); }
    .task-chip.revise { background: rgba(245,200,66,0.12); color: var(--gold); }
    .task-chip-del {
      background: none; border: none;
      color: currentColor; opacity: 0.5; cursor: pointer;
      font-size: 12px; padding: 0; line-height: 1;
    }
    .task-chip-del:hover { opacity: 1; }

    .add-task-inline {
      display: flex; gap: 6px; margin-top: 6px; flex-wrap: wrap;
    }
    .add-task-inline input {
      flex: 1; min-width: 140px;
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 8px; padding: 6px 10px;
      font-size: 12px; color: var(--text);
      font-family: 'DM Sans', sans-serif; outline: none;
    }
    .add-task-inline input:focus { border-color: var(--accent); }
    .add-task-inline select {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 8px; padding: 6px 8px;
      font-size: 12px; color: var(--text);
      font-family: 'DM Sans', sans-serif; outline: none; cursor: pointer;
    }
    .mini-btn {
      background: var(--accent);
      color: white; border: none;
      border-radius: 8px; padding: 6px 12px;
      font-size: 12px; font-weight: 600; cursor: pointer;
      transition: opacity 0.15s;
    }
    .mini-btn:hover { opacity: 0.85; }

    /* â”€â”€ MODAL â”€â”€ */
    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(4px);
      z-index: 50;
      display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none;
      transition: opacity 0.2s;
    }
    .modal-overlay.open { opacity: 1; pointer-events: all; }
    .modal {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 32px;
      width: 90%; max-width: 480px;
      transform: scale(0.95);
      transition: transform 0.2s cubic-bezier(.34,1.56,.64,1);
    }
    .modal-overlay.open .modal { transform: scale(1); }
    .modal h3 { font-family: 'Syne', sans-serif; font-size: 18px; font-weight: 700; margin-bottom: 6px; }
    .modal p  { font-size: 13px; color: var(--muted); margin-bottom: 20px; line-height: 1.5; }
    .modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
    .btn-cancel {
      background: var(--surface2); border: 1px solid var(--border);
      color: var(--muted); border-radius: 10px; padding: 10px 18px;
      font-size: 13px; cursor: pointer; transition: all 0.15s;
    }
    .btn-cancel:hover { color: var(--text); }
    .btn-confirm {
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: white; border: none; border-radius: 10px; padding: 10px 18px;
      font-family: 'Syne', sans-serif; font-size: 13px; font-weight: 700;
      cursor: pointer; transition: all 0.15s;
      box-shadow: 0 4px 12px var(--glow);
    }
    .btn-confirm:hover { transform: translateY(-1px); }
  </style>
</head>
<body>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sb-logo">
    <div class="sb-logo-mark">Mâˆ‘</div>
    <div class="sb-title">MathExcel</div>
    <div class="sb-sub">Panneau Admin</div>
  </div>

  <div class="sb-section">Gestion</div>
  <a class="sb-item active" onclick="showPanel('eleves')" href="#">
    <span class="ico">ğŸ‘¨â€ğŸ“</span> Ã‰lÃ¨ves
  </a>
  <a class="sb-item" onclick="showPanel('agenda')" href="#">
    <span class="ico">ğŸ“…</span> Agenda & Meet
  </a>
  <a class="sb-item" onclick="showPanel('planning')" href="#">
    <span class="ico">ğŸ—“ï¸</span> Planning semaine
  </a>
  <a class="sb-item" onclick="showPanel('replays')" href="#">
    <span class="ico">ğŸ¥</span> Replays
  </a>
  <a class="sb-item" onclick="showPanel('evals')" href="#">
    <span class="ico">ğŸ“Š</span> Ã‰valuations
  </a>
  <a class="sb-item" onclick="showPanel('cours')" href="#">
    <span class="ico">ğŸ“š</span> Chapitres
  </a>

  <div class="sb-section">Contenu</div>
  <a class="sb-item" onclick="showPanel('message')" href="#">
    <span class="ico">ğŸ’¬</span> Message coach
  </a>

  <div class="sb-footer">
    <a class="sb-view-btn" href="index.html" target="_blank">
      <span>ğŸ‘ï¸</span> Voir le site Ã©lÃ¨ve
    </a>
  </div>
</aside>

<!-- MAIN -->
<main class="main">
  <div class="topbar">
    <div>
      <h1 id="panelTitle">Gestion des Ã©lÃ¨ves</h1>
      <p id="panelSub">Ajoute, modifie ou supprime des Ã©lÃ¨ves</p>
    </div>
    <button class="save-btn" onclick="saveAll()">ğŸ’¾ Sauvegarder tout</button>
  </div>

  <!-- â•â•â•â• Ã‰LÃˆVES â•â•â•â• -->
  <div class="panel active" id="panel-eleves">
    <div class="section-header">
      <h2>ğŸ‘¨â€ğŸ“ Ã‰lÃ¨ves inscrits</h2>
      <p>Chaque Ã©lÃ¨ve a un accÃ¨s individuel avec son email et mot de passe.</p>
    </div>

    <div class="student-grid" id="studentGrid"></div>

    <div class="card">
      <div class="card-title">â• Ajouter un Ã©lÃ¨ve</div>
      <div class="field-row">
        <div class="field">
          <label>PrÃ©nom</label>
          <input type="text" id="newName" placeholder="ex: Thomas" />
        </div>
        <div class="field">
          <label>Email</label>
          <input type="email" id="newEmail" placeholder="thomas@email.com" />
        </div>
      </div>
      <div class="field-row">
        <div class="field">
          <label>Mot de passe</label>
          <input type="text" id="newPass" placeholder="ex: maths2025" />
        </div>
        <div class="field">
          <label>Couleur avatar</label>
          <select id="newColor">
            <option value="linear-gradient(135deg,#6C3FC5,#8B62D9)">Violet</option>
            <option value="linear-gradient(135deg,#F5C842,#FF9800)">Or</option>
            <option value="linear-gradient(135deg,#2ECC8A,#0080C0)">Ã‰meraude</option>
            <option value="linear-gradient(135deg,#F87171,#FC4A8B)">Rose</option>
            <option value="linear-gradient(135deg,#60A5FA,#3B82F6)">Bleu</option>
          </select>
        </div>
      </div>
      <button class="add-item-btn" onclick="addStudent()">â• Ajouter cet Ã©lÃ¨ve</button>
    </div>
  </div>

  <!-- â•â•â•â• AGENDA & MEET â•â•â•â• -->
  <div class="panel" id="panel-agenda">
    <div class="section-header">
      <h2>ğŸ“… Google Agenda & Google Meet</h2>
      <p>Connecte ton agenda et configure le lien de la prochaine sÃ©ance.</p>
    </div>

    <div class="card">
      <div class="card-title">ğŸ”— Synchroniser Google Agenda</div>

      <div id="agendaSyncBtn" class="sync-btn" onclick="openAgendaModal()">
        <span class="sync-icon">ğŸ“…</span>
        <div class="sync-info">
          <div class="sync-label">Connecter mon Google Agenda</div>
          <div class="sync-sub" id="agendaSyncSub">Clique pour coller le lien d'intÃ©gration</div>
        </div>
        <span class="sync-arrow">â†’</span>
      </div>

      <div class="field">
        <label>URL d'intÃ©gration (iframe src)</label>
        <input type="url" id="agendaUrl" placeholder="https://calendar.google.com/calendar/embed?src=..." oninput="updateAgendaPreview()" />
      </div>
      <div style="font-size:12px;color:var(--muted);margin-bottom:16px;line-height:1.6;">
        ğŸ“Œ Pour trouver cette URL : Google Agenda â†’ âš™ï¸ ParamÃ¨tres â†’ ton agenda â†’ "IntÃ©grer l'agenda" â†’ copie le lien dans la balise iframe
      </div>

      <div class="agenda-preview" id="agendaPreview">
        <div class="agenda-placeholder">
          <span style="font-size:36px;">ğŸ“…</span>
          <span>Colle l'URL ci-dessus pour voir un aperÃ§u</span>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">ğŸ“¹ Prochaine sÃ©ance Google Meet</div>

      <div class="field-row">
        <div class="field">
          <label>Titre de la sÃ©ance</label>
          <input type="text" id="meetTitle" placeholder="ex: Limites de suites" />
        </div>
        <div class="field">
          <label>Date et heure</label>
          <input type="text" id="meetDate" placeholder="ex: Samedi 1 mars Â· 14h00 â€“ 15h30" />
        </div>
      </div>
      <div class="field">
        <label>Lien Google Meet</label>
        <input type="url" id="meetUrl" placeholder="https://meet.google.com/xxx-xxxx-xxx" />
      </div>

      <div class="meet-status" id="meetStatus">
        <div class="meet-dot" id="meetDot"></div>
        <span id="meetStatusText" style="color:var(--muted);">Aucune sÃ©ance configurÃ©e</span>
      </div>
    </div>
  </div>

  <!-- â•â•â•â• PLANNING SEMAINE â•â•â•â• -->
  <div class="panel" id="panel-planning">
    <div class="section-header">
      <h2>ğŸ—“ï¸ Planning de la semaine</h2>
      <p>Configure les tÃ¢ches de chaque jour pour l'Ã©lÃ¨ve.</p>
    </div>
    <div class="card">
      <div class="card-title">Semaine en cours</div>
      <div class="week-grid" id="weekGrid"></div>
    </div>
  </div>

  <!-- â•â•â•â• REPLAYS â•â•â•â• -->
  <div class="panel" id="panel-replays">
    <div class="section-header">
      <h2>ğŸ¥ Replays des sÃ©ances</h2>
      <p>Ajoute les liens des enregistrements Google Meet ou YouTube.</p>
    </div>
    <div class="card">
      <div class="card-title">â• Ajouter un replay</div>
      <div class="field-row">
        <div class="field">
          <label>Titre de la sÃ©ance</label>
          <input type="text" id="replayTitle" placeholder="ex: SÃ©ance 13 â€” Limites avancÃ©es" />
        </div>
        <div class="field">
          <label>Date</label>
          <input type="text" id="replayDate" placeholder="ex: 1 mar 2025" />
        </div>
      </div>
      <div class="field-row">
        <div class="field">
          <label>DurÃ©e</label>
          <input type="text" id="replayDuration" placeholder="ex: 1h30" />
        </div>
        <div class="field">
          <label>Lien vidÃ©o (Google Drive ou YouTube)</label>
          <input type="url" id="replayUrl" placeholder="https://drive.google.com/..." />
        </div>
      </div>
      <button class="add-item-btn" onclick="addReplay()">â• Ajouter ce replay</button>
    </div>
    <div class="card">
      <div class="card-title">ğŸ“‹ Replays enregistrÃ©s</div>
      <div class="list-items" id="replayList"></div>
    </div>
  </div>

  <!-- â•â•â•â• Ã‰VALUATIONS â•â•â•â• -->
  <div class="panel" id="panel-evals">
    <div class="section-header">
      <h2>ğŸ“Š Ã‰valuations</h2>
      <p>Ajoute les notes et commentaires aprÃ¨s chaque contrÃ´le.</p>
    </div>
    <div class="card">
      <div class="card-title">â• Ajouter une Ã©valuation</div>
      <div class="field-row">
        <div class="field">
          <label>Nom du DS / Interrogation</label>
          <input type="text" id="evalName" placeholder="ex: DS Suites â€” RÃ©currence" />
        </div>
        <div class="field">
          <label>Date</label>
          <input type="text" id="evalDate" placeholder="ex: 1 mar 2025" />
        </div>
      </div>
      <div class="field-row-3">
        <div class="field">
          <label>Note obtenue</label>
          <input type="number" id="evalNote" placeholder="ex: 15" min="0" max="20" />
        </div>
        <div class="field">
          <label>Note max</label>
          <input type="number" id="evalMax" placeholder="20" value="20" />
        </div>
        <div class="field">
          <label>Couleur</label>
          <select id="evalClass">
            <option value="good">ğŸŸ¢ Bon (vert)</option>
            <option value="ok">ğŸŸ¡ Moyen (orange)</option>
            <option value="bad">ğŸ”´ Ã€ retravailler (rouge)</option>
          </select>
        </div>
      </div>
      <div class="field">
        <label>Commentaire personnalisÃ©</label>
        <textarea id="evalComment" placeholder="ex: Bonne maÃ®trise de la structure. Attention Ã  la phrase de conclusion..."></textarea>
      </div>
      <div class="field">
        <label>Tags (sÃ©parÃ©s par des virgules)</label>
        <input type="text" id="evalTags" placeholder="ex: RÃ©currence, Suites, RÃ©daction" />
      </div>
      <button class="add-item-btn" onclick="addEval()">â• Ajouter cette Ã©valuation</button>
    </div>
    <div class="card">
      <div class="card-title">ğŸ“‹ Ã‰valuations enregistrÃ©es</div>
      <div class="list-items" id="evalList"></div>
    </div>
  </div>

  <!-- â•â•â•â• CHAPITRES â•â•â•â• -->
  <div class="panel" id="panel-cours">
    <div class="section-header">
      <h2>ğŸ“š Chapitres du programme</h2>
      <p>Modifie le statut et les ressources de chaque chapitre.</p>
    </div>
    <div class="card">
      <div class="card-title">ğŸ“‹ Liste des chapitres</div>
      <div class="list-items" id="coursList"></div>
    </div>
  </div>

  <!-- â•â•â•â• MESSAGE COACH â•â•â•â• -->
  <div class="panel" id="panel-message">
    <div class="section-header">
      <h2>ğŸ’¬ Message de ton coach</h2>
      <p>Ce message s'affiche dans l'espace objectifs de l'Ã©lÃ¨ve.</p>
    </div>
    <div class="card">
      <div class="card-title">âœï¸ RÃ©diger le message de la semaine</div>
      <div class="field">
        <label>Titre de la semaine</label>
        <input type="text" id="msgTitle" placeholder="ex: Semaine du 24 fÃ©vrier" />
      </div>
      <div class="field">
        <label>Message</label>
        <textarea id="msgBody" style="min-height:140px;"
          placeholder="ex: Beau travail la semaine derniÃ¨re ! Cette semaine on attaque les limites..."></textarea>
      </div>
      <div class="field">
        <label>Call to action (optionnel)</label>
        <input type="text" id="msgCta" placeholder="ex: Objectif : finir les exercices niveau 1 avant samedi ğŸ’ª" />
      </div>
      <button class="add-item-btn" onclick="saveMessage()">âœ… Enregistrer le message</button>

      <div style="margin-top:20px;padding:16px;background:var(--surface2);border-radius:10px;border:1px solid var(--border);">
        <div style="font-size:12px;color:var(--muted);margin-bottom:8px;text-transform:uppercase;font-weight:600;letter-spacing:0.5px;">AperÃ§u</div>
        <div id="msgPreview" style="font-size:14px;line-height:1.7;color:var(--muted);">Le message apparaÃ®tra ici...</div>
      </div>
    </div>
  </div>

</main>

<!-- MODAL Google Agenda -->
<div class="modal-overlay" id="agendaModal">
  <div class="modal">
    <h3>ğŸ“… Connecter Google Agenda</h3>
    <p>
      1. Va sur <strong style="color:var(--accent2);">calendar.google.com</strong><br/>
      2. Clique sur âš™ï¸ â†’ ParamÃ¨tres<br/>
      3. SÃ©lectionne ton agenda â†’ "IntÃ©grer l'agenda"<br/>
      4. Copie le lien dans la balise <code style="background:var(--surface2);padding:2px 6px;border-radius:4px;">src="..."</code>
    </p>
    <div class="field">
      <label>Colle l'URL ici</label>
      <input type="url" id="modalAgendaUrl" placeholder="https://calendar.google.com/calendar/embed?src=..." />
    </div>
    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeModal('agendaModal')">Annuler</button>
      <button class="btn-confirm" onclick="confirmAgendaUrl()">Connecter â†’</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast">âœ“ <span id="toastMsg">SauvegardÃ© !</span></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH â€” accÃ¨s admin uniquement
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ADMIN_PASS = "admin2025"; // Change ce mot de passe
if (sessionStorage.getItem('adminAuth') !== 'ok') {
  const p = prompt("ğŸ”’ Mot de passe administrateur :");
  if (p !== ADMIN_PASS) {
    document.body.innerHTML = `<div style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:sans-serif;color:#aaa;">AccÃ¨s refusÃ©.</div>`;
  } else {
    sessionStorage.setItem('adminAuth', 'ok');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE â€” stored in localStorage
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STATE_KEY = 'mathexcel_admin_state';

const DEFAULT_STATE = {
  students: [
    { name: "Thomas", email: "thomas.dupont@email.com", pass: "maths2024", color: "linear-gradient(135deg,#6C3FC5,#8B62D9)" },
    { name: "LÃ©a",    email: "lea.martin@email.com",    pass: "maths2024", color: "linear-gradient(135deg,#F5C842,#FF9800)" },
    { name: "Hugo",   email: "hugo.bernard@email.com",  pass: "maths2024", color: "linear-gradient(135deg,#2ECC8A,#0080C0)" },
  ],
  agendaUrl: "",
  meetTitle: "Prochaine sÃ©ance â€” SpÃ© Maths",
  meetDate: "Samedi 1 mars Â· 14h00 â€“ 15h30",
  meetUrl: "",
  weekPlan: [
    { day: "LUN", tasks: [] },
    { day: "MAR", tasks: [{ text: "VidÃ©o Limites (20 min)", type: "cours" }] },
    { day: "MER", tasks: [{ text: "Exercices Limites niv.1", type: "exo" }] },
    { day: "JEU", tasks: [{ text: "Fiche mÃ©thode Ã  relire", type: "revise" }] },
    { day: "VEN", tasks: [{ text: "Exercices niv.2", type: "exo" }] },
    { day: "SAM", tasks: [{ text: "Cours particulier 14h-15h30", type: "cours" }] },
    { day: "DIM", tasks: [{ text: "Organisation semaine", type: "revise" }] },
  ],
  replays: [
    { title: "SÃ©ance 12 â€” Limites infinies", date: "22 fÃ©v 2025", duration: "1h28", url: "#" },
    { title: "SÃ©ance 11 â€” RÃ©currence (correction DS)", date: "15 fÃ©v 2025", duration: "1h35", url: "#" },
  ],
  evals: [
    { name: "DS Suites â€” RÃ©currence", date: "20 fÃ©v 2025", note: 15, max: 20,
      comment: "TrÃ¨s bonne maÃ®trise de la structure.", tags: ["RÃ©currence","Suites"], noteClass: "good" },
    { name: "DS DÃ©rivation", date: "15 jan 2025", note: 17, max: 20,
      comment: "Excellent ! Calculs propres, rÃ©daction parfaite.", tags: ["DÃ©rivation"], noteClass: "good" },
  ],
  chapters: [
    { num: 1,  name: "Suites â€” Raisonnement par rÃ©currence", status: "done" },
    { num: 2,  name: "Suites â€” Limites",                     status: "current" },
    { num: 3,  name: "Suites â€” OpÃ©rations sur les limites",  status: "locked" },
    { num: 4,  name: "DÃ©rivation",                           status: "done" },
    { num: 5,  name: "Fonction exponentielle",               status: "locked" },
    { num: 6,  name: "Fonctions trigonomÃ©triques",           status: "locked" },
    { num: 7,  name: "Produit scalaire",                     status: "locked" },
    { num: 8,  name: "GÃ©omÃ©trie repÃ©rÃ©e",                    status: "locked" },
    { num: 9,  name: "ProbabilitÃ©s conditionnelles",         status: "done" },
    { num: 10, name: "Variables alÃ©atoires",                 status: "done" },
    { num: 11, name: "Loi binomiale",                        status: "locked" },
    { num: 12, name: "Algorithmique Python",                 status: "locked" },
  ],
  message: { title: "Semaine du 24 fÃ©vrier", body: "Beau travail sur la rÃ©currence ! Cette semaine on attaque les limites. Concentre-toi d'abord sur l'intuition avant les exercices.", cta: "Objectif : finir les exercices niveau 1 et 2 avant samedi ğŸ’ª" }
};

let state = JSON.parse(localStorage.getItem(STATE_KEY) || 'null') || DEFAULT_STATE;

function save() {
  localStorage.setItem(STATE_KEY, JSON.stringify(state));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PANEL NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const panelMeta = {
  eleves:   { title: "Gestion des Ã©lÃ¨ves",         sub: "Ajoute, modifie ou supprime des Ã©lÃ¨ves" },
  agenda:   { title: "Agenda & Google Meet",        sub: "Synchronise ton calendrier et configure les sÃ©ances" },
  planning: { title: "Planning de la semaine",      sub: "TÃ¢ches jour par jour pour l'Ã©lÃ¨ve" },
  replays:  { title: "Replays des sÃ©ances",         sub: "Liens vers les enregistrements" },
  evals:    { title: "Ã‰valuations",                 sub: "Notes et commentaires personnalisÃ©s" },
  cours:    { title: "Chapitres du programme",      sub: "Statut et ressources de chaque chapitre" },
  message:  { title: "Message du coach",            sub: "AffichÃ© dans l'espace objectifs de l'Ã©lÃ¨ve" },
};

function showPanel(id) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.sb-item').forEach(n => n.classList.remove('active'));
  document.getElementById('panel-' + id).classList.add('active');
  event.currentTarget.classList.add('active');
  document.getElementById('panelTitle').textContent = panelMeta[id].title;
  document.getElementById('panelSub').textContent   = panelMeta[id].sub;
  renderPanel(id);
}

function renderPanel(id) {
  if (id === 'eleves')   renderStudents();
  if (id === 'agenda')   renderAgenda();
  if (id === 'planning') renderWeekPlanner();
  if (id === 'replays')  renderReplays();
  if (id === 'evals')    renderEvals();
  if (id === 'cours')    renderChapters();
  if (id === 'message')  renderMessage();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STUDENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderStudents() {
  const grid = document.getElementById('studentGrid');
  grid.innerHTML = '';
  state.students.forEach((s, i) => {
    const card = document.createElement('div');
    card.className = 'student-card';
    card.innerHTML = `
      <button class="student-card-del" onclick="deleteStudent(${i})">âœ•</button>
      <div class="student-card-top">
        <div class="student-avatar" style="background:${s.color}">${s.name[0]}</div>
        <div>
          <div class="student-card-name">${s.name}</div>
          <div class="student-card-email">${s.email}</div>
        </div>
      </div>
      <div class="student-field">
        <label>PrÃ©nom</label>
        <input value="${s.name}" oninput="state.students[${i}].name=this.value;save()" />
      </div>
      <div class="student-field">
        <label>Email</label>
        <input value="${s.email}" oninput="state.students[${i}].email=this.value;save()" />
      </div>
      <div class="student-field">
        <label>Mot de passe</label>
        <input value="${s.pass}" oninput="state.students[${i}].pass=this.value;save()" />
      </div>`;
    grid.appendChild(card);
  });
}

function addStudent() {
  const name  = document.getElementById('newName').value.trim();
  const email = document.getElementById('newEmail').value.trim();
  const pass  = document.getElementById('newPass').value.trim();
  const color = document.getElementById('newColor').value;
  if (!name || !email || !pass) { showToast('âš ï¸ Remplis tous les champs'); return; }
  state.students.push({ name, email, pass, color });
  save(); renderStudents();
  document.getElementById('newName').value = '';
  document.getElementById('newEmail').value = '';
  document.getElementById('newPass').value = '';
  showToast('âœ“ Ã‰lÃ¨ve ajoutÃ© !');
}

function deleteStudent(i) {
  if (confirm(`Supprimer ${state.students[i].name} ?`)) {
    state.students.splice(i, 1); save(); renderStudents();
    showToast('âœ“ Ã‰lÃ¨ve supprimÃ©');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AGENDA & MEET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAgenda() {
  document.getElementById('agendaUrl').value  = state.agendaUrl || '';
  document.getElementById('meetTitle').value  = state.meetTitle || '';
  document.getElementById('meetDate').value   = state.meetDate  || '';
  document.getElementById('meetUrl').value    = state.meetUrl   || '';
  updateAgendaPreview();
  updateMeetStatus();

  ['meetTitle','meetDate','meetUrl'].forEach(id => {
    document.getElementById(id).addEventListener('input', function() {
      const key = id.replace('meet','meet').replace('Title','Title').replace('Date','Date').replace('Url','Url');
      state[id.charAt(0).toLowerCase() + id.slice(1)] = this.value;
      save(); updateMeetStatus();
    });
  });
}

function updateAgendaPreview() {
  const url = document.getElementById('agendaUrl').value.trim();
  state.agendaUrl = url; save();
  const preview = document.getElementById('agendaPreview');
  if (url) {
    preview.innerHTML = `<iframe src="${url}" frameborder="0" scrolling="no" style="width:100%;height:350px;border:0;"></iframe>`;
    const btn = document.getElementById('agendaSyncBtn');
    btn.classList.add('connected');
    document.getElementById('agendaSyncSub').textContent = 'âœ“ Agenda connectÃ©';
  } else {
    preview.innerHTML = `<div class="agenda-placeholder"><span style="font-size:36px;">ğŸ“…</span><span>Colle l'URL ci-dessus pour voir un aperÃ§u</span></div>`;
  }
}

function updateMeetStatus() {
  const url = document.getElementById('meetUrl').value.trim();
  const title = document.getElementById('meetTitle').value.trim();
  const date  = document.getElementById('meetDate').value.trim();
  const dot  = document.getElementById('meetDot');
  const text = document.getElementById('meetStatusText');
  if (url && title) {
    dot.classList.add('active');
    text.textContent = `âœ“ SÃ©ance configurÃ©e : ${title} â€” ${date}`;
    text.style.color = 'var(--green)';
  } else {
    dot.classList.remove('active');
    text.textContent = 'Aucune sÃ©ance configurÃ©e';
    text.style.color = 'var(--muted)';
  }
}

function openAgendaModal() { document.getElementById('agendaModal').classList.add('open'); }
function closeModal(id)   { document.getElementById(id).classList.remove('open'); }
function confirmAgendaUrl() {
  const url = document.getElementById('modalAgendaUrl').value.trim();
  if (url) { document.getElementById('agendaUrl').value = url; updateAgendaPreview(); }
  closeModal('agendaModal');
  showToast('âœ“ Agenda connectÃ© !');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WEEK PLANNER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderWeekPlanner() {
  const grid = document.getElementById('weekGrid');
  grid.innerHTML = '';
  state.weekPlan.forEach((day, di) => {
    const labelEl = document.createElement('div');
    labelEl.className = 'week-day-label';
    labelEl.textContent = day.day;
    grid.appendChild(labelEl);

    const tasksEl = document.createElement('div');
    tasksEl.className = 'week-day-tasks';

    function refreshTasks() {
      tasksEl.innerHTML = '';
      day.tasks.forEach((task, ti) => {
        const chip = document.createElement('span');
        chip.className = `task-chip ${task.type}`;
        chip.innerHTML = `${task.text}<button class="task-chip-del" onclick="deleteTask(${di},${ti})">âœ•</button>`;
        tasksEl.appendChild(chip);
      });
      // Add row
      const addRow = document.createElement('div');
      addRow.className = 'add-task-inline';
      addRow.innerHTML = `
        <input type="text" placeholder="Ajouter une tÃ¢che..." id="taskInput-${di}" />
        <select id="taskType-${di}">
          <option value="cours">ğŸ“˜ Cours</option>
          <option value="exo">ğŸ“ Exercices</option>
          <option value="revise">ğŸ” RÃ©vision</option>
        </select>
        <button class="mini-btn" onclick="addTask(${di})">+</button>`;
      tasksEl.appendChild(addRow);
    }

    refreshTasks();
    grid.appendChild(tasksEl);
  });
}

function addTask(di) {
  const input = document.getElementById(`taskInput-${di}`);
  const type  = document.getElementById(`taskType-${di}`).value;
  const text  = input.value.trim();
  if (!text) return;
  state.weekPlan[di].tasks.push({ text, type });
  save(); renderWeekPlanner();
  showToast('âœ“ TÃ¢che ajoutÃ©e');
}

function deleteTask(di, ti) {
  state.weekPlan[di].tasks.splice(ti, 1);
  save(); renderWeekPlanner();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REPLAYS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderReplays() {
  const list = document.getElementById('replayList');
  list.innerHTML = '';
  if (!state.replays.length) {
    list.innerHTML = '<div style="text-align:center;color:var(--muted);padding:20px;font-size:14px;">Aucun replay enregistrÃ©</div>';
    return;
  }
  state.replays.forEach((r, i) => {
    const el = document.createElement('div');
    el.className = 'list-item';
    el.innerHTML = `
      <div class="list-item-icon">ğŸ¥</div>
      <div class="list-item-info">
        <div class="list-item-name">${r.title}</div>
        <div class="list-item-meta">${r.date} Â· ${r.duration} Â· <a href="${r.url}" target="_blank" style="color:var(--accent2);">Voir le lien</a></div>
      </div>
      <button class="del-btn" onclick="deleteReplay(${i})">ğŸ—‘</button>`;
    list.appendChild(el);
  });
}

function addReplay() {
  const title    = document.getElementById('replayTitle').value.trim();
  const date     = document.getElementById('replayDate').value.trim();
  const duration = document.getElementById('replayDuration').value.trim();
  const url      = document.getElementById('replayUrl').value.trim();
  if (!title || !date || !url) { showToast('âš ï¸ Remplis titre, date et lien'); return; }
  state.replays.unshift({ title, date, duration: duration || '?', url });
  save(); renderReplays();
  ['replayTitle','replayDate','replayDuration','replayUrl'].forEach(id => document.getElementById(id).value = '');
  showToast('âœ“ Replay ajoutÃ© !');
}

function deleteReplay(i) {
  state.replays.splice(i, 1); save(); renderReplays();
  showToast('âœ“ Replay supprimÃ©');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EVALS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderEvals() {
  const list = document.getElementById('evalList');
  list.innerHTML = '';
  if (!state.evals.length) {
    list.innerHTML = '<div style="text-align:center;color:var(--muted);padding:20px;font-size:14px;">Aucune Ã©valuation</div>';
    return;
  }
  state.evals.forEach((e, i) => {
    const el = document.createElement('div');
    el.className = 'list-item';
    const badgeClass = { good: 'badge-good', ok: 'badge-ok', bad: 'badge-bad' }[e.noteClass];
    el.innerHTML = `
      <div class="list-item-icon">ğŸ“Š</div>
      <div class="list-item-info">
        <div class="list-item-name">${e.name}</div>
        <div class="list-item-meta">${e.date} Â· ${e.comment.slice(0,60)}...</div>
      </div>
      <span class="list-item-badge ${badgeClass}">${e.note}/${e.max}</span>
      <button class="del-btn" onclick="deleteEval(${i})">ğŸ—‘</button>`;
    list.appendChild(el);
  });
}

function addEval() {
  const name      = document.getElementById('evalName').value.trim();
  const date      = document.getElementById('evalDate').value.trim();
  const note      = parseInt(document.getElementById('evalNote').value);
  const max       = parseInt(document.getElementById('evalMax').value) || 20;
  const noteClass = document.getElementById('evalClass').value;
  const comment   = document.getElementById('evalComment').value.trim();
  const tagsRaw   = document.getElementById('evalTags').value.trim();
  if (!name || !date || isNaN(note)) { showToast('âš ï¸ Remplis les champs obligatoires'); return; }
  const tags = tagsRaw ? tagsRaw.split(',').map(t => t.trim()) : [];
  state.evals.unshift({ name, date, note, max, noteClass, comment, tags });
  save(); renderEvals();
  ['evalName','evalDate','evalNote','evalComment','evalTags'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('evalMax').value = '20';
  showToast('âœ“ Ã‰valuation ajoutÃ©e !');
}

function deleteEval(i) {
  state.evals.splice(i, 1); save(); renderEvals();
  showToast('âœ“ Ã‰valuation supprimÃ©e');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHAPTERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderChapters() {
  const list = document.getElementById('coursList');
  list.innerHTML = '';
  state.chapters.forEach((ch, i) => {
    const el = document.createElement('div');
    el.className = 'list-item';
    const badgeClass = { done: 'badge-done', current: 'badge-active', locked: 'badge-locked' }[ch.status];
    const badgeLabel = { done: 'TerminÃ© âœ“', current: 'En cours', locked: 'Ã€ venir' }[ch.status];
    el.innerHTML = `
      <div class="list-item-icon" style="width:30px;height:30px;background:linear-gradient(135deg,#4A2A8F,#6C3FC5);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:white;">${ch.num}</div>
      <div class="list-item-info">
        <div class="list-item-name">${ch.name}</div>
      </div>
      <select style="background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:6px 10px;font-size:12px;color:var(--text);outline:none;" onchange="state.chapters[${i}].status=this.value;save();renderChapters()">
        <option value="locked"  ${ch.status==='locked'  ?'selected':''}>Ã€ venir</option>
        <option value="current" ${ch.status==='current' ?'selected':''}>En cours</option>
        <option value="done"    ${ch.status==='done'    ?'selected':''}>TerminÃ©</option>
      </select>`;
    list.appendChild(el);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MESSAGE COACH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderMessage() {
  document.getElementById('msgTitle').value = state.message.title || '';
  document.getElementById('msgBody').value  = state.message.body  || '';
  document.getElementById('msgCta').value   = state.message.cta   || '';
  updateMsgPreview();
  ['msgTitle','msgBody','msgCta'].forEach(id => {
    document.getElementById(id).addEventListener('input', updateMsgPreview);
  });
}

function updateMsgPreview() {
  const title = document.getElementById('msgTitle').value || 'â€”';
  const body  = document.getElementById('msgBody').value  || 'â€”';
  const cta   = document.getElementById('msgCta').value;
  document.getElementById('msgPreview').innerHTML =
    `<strong style="color:var(--text)">${title}</strong><br/><br/>${body}${cta ? `<br/><br/><em style="color:var(--accent2)">${cta}</em>` : ''}`;
}

function saveMessage() {
  state.message = {
    title: document.getElementById('msgTitle').value,
    body:  document.getElementById('msgBody').value,
    cta:   document.getElementById('msgCta').value,
  };
  save(); showToast('âœ“ Message sauvegardÃ© !');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GLOBAL SAVE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveAll() {
  // Collect meet fields manually
  state.meetTitle = document.getElementById('meetTitle')?.value || state.meetTitle;
  state.meetDate  = document.getElementById('meetDate')?.value  || state.meetDate;
  state.meetUrl   = document.getElementById('meetUrl')?.value   || state.meetUrl;
  save();
  showToast('âœ“ Tout sauvegardÃ© !');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let toastTimer;
function showToast(msg) {
  const t = document.getElementById('toast');
  document.getElementById('toastMsg').textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 2500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
renderStudents();
</script>
</body>
</html>
